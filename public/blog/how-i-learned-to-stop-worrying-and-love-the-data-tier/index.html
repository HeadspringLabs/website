
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>How I learned to stop worrying and love the data tier - Headspring Labs</title>
  <meta name="author" content="Headspring Labs">

  
  <meta name="description" content="At some point in 2005 or so, I started using ORMs to perform data access to a RDBMS. ORMs solved a lot of problems I was running into as a developer &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://headspringlabs.com/blog/how-i-learned-to-stop-worrying-and-love-the-data-tier">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Headspring Labs" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Headspring Labs</a></h1>
  
    <h2>Experiments by Headspringers!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:headspringlabs.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">How I Learned to Stop Worrying and Love the Data Tier</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-23T00:00:00-06:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>At some point in 2005 or so, I started using ORMs to perform data access to a RDBMS. ORMs solved a lot of problems I was running into as a developer, namely all the boring ADO.NET code to deal with reading data and populating objects. Previously, my data mapping strategy was something like writing a bunch of stored procedures and corresponding ADO.NET code that is hard to write and even harder to maintain.</p>
<p>I would wind up with a lot of code dealing with DBNull and such, but not much of the code dealt with actually reading information out. It was annoying. It was easy to get wrong. In my attempt to rid myself of this kind of code, I ditched all the things that SQL Server does well.<!--more--></p>
<p>Using an ORM, especially with databases with large amounts of data, does not preclude the developer from learning these systems. It’s one thing to say we’re ditching Stored Procedures, but yet another to ignore all of the other things that RDBMS does well, and can very much impact the end-user experience of a system.</p>
<p>I had ditched a lot of things in SQL Server when going to ORMs, namely:</p>
<ul>
<li>Views</li>
<li>Indexes</li>
<li>Custom SQL projections</li>
<li>Aggregation</li>
<li><a href="http://msdn.microsoft.com/en-us/library/ms190766.aspx">Common Table Expressions</a> (CTEs)</li>
</ul>
<p>In short, all of the things that make RDBMS work well. It wasn’t the ORM that forced me down this path. It was my own bias.</p>
<p>Recently, we hit an issue where we were wanting to enforce uniqueness of the member’s email in the system. We had a set of code on a user creating an account:</p>
<p><div><script src='https://gist.github.com/1871924.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>This worked well when only one user tried to save their email at any given time. But in a messaging system, we often do things like increase throughput by increasing workers. But that introduces the problem of dirty reads. If between the time the system checks the database for uniqueness and finally saves the member, that email could (and did) sneak in.</p>
<p>So how did we solve this? Not by removing this code, but putting in a unique constraint and an index on that column. Now I’ve <em>guaranteed</em> uniqueness for that value, instead of having just a hope that the value is unique. It’s something that the database does, and does well. So instead of worrying about logic in SQL stored procedures, which I won’t do, I’ll look at what SQL does well, and take advantage of those features as necessary.</p>
<p>It’s the same side of the coin of “use the right tool for the job”. It’s “be aware of what tools work best in what scenarios, and tradeoffs for those scenarios.”</p>
</div>


  <footer>
    <p class="meta">
      
  



      








  


<time datetime="2012-02-23T00:00:00-06:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2012</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://headspringlabs.com/blog/how-i-learned-to-stop-worrying-and-love-the-data-tier/" data-via="HeadspringLabs" data-counturl="http://headspringlabs.com/blog/how-i-learned-to-stop-worrying-and-love-the-data-tier/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/are-user-groups-and-conferences-worth-my-time/" title="Previous Post: Are User Groups and Conferences Worth My Time?">&laquo; Are User Groups and Conferences Worth My Time?</a>
      
      
        <a class="basic-alignment right" href="/blog/detached-head-state/" title="Next Post: Detached HEAD State">Detached HEAD State &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/dry-test-inheritance/">DRY Test Inheritance</a>
      </li>
    
      <li class="post">
        <a href="/blog/the-sincerest-form-of-flattery/">The Sincerest Form of Flattery</a>
      </li>
    
      <li class="post">
        <a href="/blog/fixies-life-bicycle/">Fixie's Life Bicycle</a>
      </li>
    
      <li class="post">
        <a href="/blog/test-discovery/">Test Discovery</a>
      </li>
    
      <li class="post">
        <a href="/blog/enabling-change/">Enabling Change</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/HeadspringLabs">@HeadspringLabs</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'HeadspringLabs',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Headspring Labs -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

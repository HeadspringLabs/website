
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>A Game of Throws - Headspring Labs</title>
	<meta name="author" content="Headspring Labs">

	
	<meta name="description" content="In Infinite Laziness, we saw how the yield keyword lets us work with lazy evaluation, in which work is deferred and performed on demand once &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Headspring Labs" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.1.6/d3.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><a href="/"><h1>Headspring Labs</h1></a>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/team">The Team</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/open-source">Open Source</a></li>
	<li><a href="/about-us">About Us</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:headspringlabs.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/HeadspringLabs" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/HeadspringLabs" title="GitHub">GitHub</a>
		
	    
		
		<a class="coderwall" href="https://coderwall.com/team/headspring" title="Coderwall">Coderwall</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:headspringlabs.com">
	</form>
</nav>
<nav id="main-nav"><ul class="main">
	<li><a href="/team">The Team</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/open-source">Open Source</a></li>
	<li><a href="/about-us">About Us</a></li>
</ul>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">A Game of Throws</h2>
	<div class="entry-content"><p>In <a href="http://www.headspring.com/blog/developer-deep-dive/infinite-laziness/">Infinite Laziness</a>, we saw how the <code>yield</code> keyword lets us work with <em>lazy evaluation</em>, in which work is deferred and performed on demand once something else actually needs to consume the result.  Lazy evaluation with <code>yield</code> isn&#8217;t free, though; it has some unfortunate consequences.</p>
<p>This week, we&#8217;ll see how lazy evaluation affects exception handling.  Next week, we&#8217;ll see how <code>yield</code> complects brevity with laziness, resulting in some undesirable patterns.</p>
<p>Let&#8217;s say you&#8217;re lazily producing a series of objects, but the creation of each object has a real potential to throw an exception.  The developer calling the lazy method knows that the operation could fail, and attempts to protect the rest of the system:</p>
<p><div><script src='https://gist.github.com/3792131.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Despite wrapping the dangerous method call with a <code>try/catch</code> block, callers of SafelyBuildGrenades are in for a surprise.  <strong>The call to BuildGrenades will never throw an ExplosionException, while callers of SafelyBuildGrenades might set off a grenade just by looking at them!</strong></p>
<p>When you call a <code>yield</code>ing method, <strong>no work is performed and the call returns immediately</strong>.  It returns an object that <em>knows how</em> to produce the list of items on demand.  Those items won&#8217;t be produced until someone starts looping through them.  In our example above, this quickly-made object is likewise immediately returned by SafelyBuildGrenades.  The <em>consumer</em> of the result of SafelyBuildGrenades is then free to start looping through it, at which point the code in BuildGrenades will start to execute.  Since an ExplosionException could only be thrown way up in that consumer&#8217;s loop, the consumer&#8217;s loop is where the exception will start moving up the call stack.</p>
<blockquote><p><code>yield</code> is an exception smuggler.  <code>yield</code> hides your dangerous code in a harmless-looking package in order to sneak it past unsuspecting <code>try/catch</code> blocks.  The harmful contents can then be unpacked by the recipient.</p></blockquote>
<p>When using lazy evaluation, which includes the now-ubiquitous IEnumerable extension methods (Select, Where, Take, Skip&#8230;), take care.  Work won&#8217;t be performed until you begin to iterate through the results, so your exception handling will need to take place higher up the call stack.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-09-27T00:00:00-05:00" pubdate data-updated="true">Sep 27<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>


</div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
		
		
		<a class="addthis_button_tweet"></a>
		
		
		
	</div>
	
</div>


</div>
	<footer id="footer" class="inner"><div class="related-links">
	<h3>Other Headspring Sites</h3>
	<ul>
		
		
			<li><a href="http://www.headspring.com">Headspring</a></li>
		
		
			<li><a href="http://www.headspringmobile.com">Headspring Mobile</a></li>
		
	</ul>
</div>

<div class="related-links">
	<h3>Communities/Groups</h3>
	<ul>
		
		
			<li><a href="http://www.adnug.org">ADNUG</a></li>
		
		
			<li><a href="http://polyglotprogrammers.org/">Polyglot Programmers</a></li>
		
	</ul>
</div>

<div class="related-links">
	<h3>Open Source</h3>
	<ul>
		
		
			
				
				<li><a href="http://automapper.org">AutoMapper</a></li>
				
			
		
		
			
				
				<li><a href="https://github.com/HeadspringLabs/Enumeration">Enumeration</a></li>
				
			
		
		
			
				
				<li><a href="http://chrismissal.com/Formo">Formo</a></li>
				
			
		
		
			
				
				<li><a href="http://plioi.github.io/fixie">Fixie</a></li>
				
			
		
		
			
		
		
			
		
		
			
		
	</ul>
</div>

<div class="related-links">
	<h3>Events</h3>
	<ul>
		
		
			<li><a href="http://ctxgivecamp.org/">Central Texas GiveCamp</a></li>
		
		
			<li><a href="http://www.houstontechfest.org/">Houston Tech Fest</a></li>
		
		
			<li><a href="http://codecamp13.adnug.org/">Austin Code Camp</a></li>
		
	</ul>
</div>

<hr />

Copyright &copy; 2013

    Headspring Labs

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>
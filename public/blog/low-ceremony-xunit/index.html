
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Low-Ceremony xUnit - Headspring Labs</title>
	<meta name="author" content="Headspring Labs">

	
	<meta name="description" content="&#8220;High Ceremony&#8221; software includes excessive detail which distracts from the essential thing the coder is trying to convey. In C# for &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Headspring Labs" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><a href="/"><h1>Headspring Labs</h1></a>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/team">The Team</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/open-source">Open Source</a></li>
	<li><a href="/about-us">About Us</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:headspringlabs.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/HeadspringLabs" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/HeadspringLabs" title="GitHub">GitHub</a>
		
	    
		
		<a class="coderwall" href="https://coderwall.com/team/headspring" title="Coderwall">Coderwall</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:headspringlabs.com">
	</form>
</nav>
<nav id="main-nav"><ul class="main">
	<li><a href="/team">The Team</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/open-source">Open Source</a></li>
	<li><a href="/about-us">About Us</a></li>
</ul>
</nav>

</header>
	
		
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/HeadspringLabs">HeadspringLabs</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('HeadspringLabs', 5, );
	})(jQuery);
</script>

	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Low-Ceremony xUnit</h2>
	<div class="entry-content"><p>&#8220;High Ceremony&#8221; software includes excessive detail which distracts from the essential thing the coder is trying to convey.  In C# for instance, you could argue that having to place <em>all</em> methods inside classes is needless ceremony.  Your Main() method shouldn&#8217;t need that extra boilerplate, but we just Have To Do It That Way.  We have to perform that ceremony.  Developers who favor dynamic languages would find type declarations to be High Ceremony as well, and even C#ers admit this whenever they use the <code>var</code> or <code>dynamic</code> keywords.</p>
<p>High ceremony isn&#8217;t limited to language details, though.  We can be guilty of introducing it, ourselves.</p>
<h2>Framework Ceremony</h2>
<p>Frameworks often impose ceremony of their own.  ASP.NET MVC, NUnit, and xUnit all require you to litter your code with <code>[Attribte]</code>s in order to give instructions to the framework.  The framework reflects over your code, discovers these attributes, and takes action.  Usually this is all done so that the framework will know when, during its own lifecycle, your code should be invoked.  Take a look at NUnit test fixtures:</p>
<p><div><script src='https://gist.github.com/3688610.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>We <em>want</em> to simply define a named test and make an assertion about our system.  Additionally, we have to pay the Attribute Tax so that NUnit knows which classes contain tests (<code>[TestFixture]</code>), and which methods within those classes are tests (<code>[Test]</code>).  When you take part in the rest of the NUnit fixture lifecycle, you have to litter even more attributes around like <code>[SetUp]</code>, <code>[TearDown]</code>, <code>[TestFixtureSetUp]</code>, and <code>[TestFixtureTearDown]</code>.  Since these lifecycle attributes usually decorate methods with the same name as the attribute, it gets even more pointlessly verbose:</p>
<p><div><script src='https://gist.github.com/3688440.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>xUnit avoids <em>some</em> of this by using different conventions.  Test methods are still marked with an attribute (this time, <code>[Fact]</code> instead of <code>[Test]</code>).  Instead of marking test classes with an attribute, xUnit just infers the obvious: any class with <code>[Fact]</code>s must be a test class.  Instead of setup and teardown methods, xUnit relies on idioms already common in C#: default constructors for setup, and Dispose() for teardown.</p>
<p>I&#8217;ve been using xUnit over NUnit for these reasons (however trivial they are in the context of a large project).  Still, I hate typing ceremony into a project, and it seems like xUnit&#8217;s default conventions got it backwards: why not place an attribute on the test class itself, and then just <em>assume</em> all the public methods in them are tests?</p>
<h2>Minimizing xUnit&#8217;s Ceremony</h2>
<p>One important benefit of xUnit over NUnit is that xUnit is partially customizable.  If you want to define your own alternative to <code>[Fact]</code>, you can.  Also, if you want to use your own convention for discovering which methods in a test class are actually test cases, you can define your own class-level attribute.  This custom attribute goes at the top of the test class and basically means, &#8220;Hold on xUnit, I&#8217;ll take it from here.&#8221;</p>
<p>To implement your own test-method-discovery convention, you must implement ITestClassCommand.  Unfortunately, this interface violates the <a href="http://en.wikipedia.org/wiki/Interface_segregation_principle">Interface Segregation Principle</a>: this interface is large, serving several purposes.  I&#8217;m only interested in providing a new method which says whether or not a given method is a test method.  <strong>Instead of only telling xUnit how to do that, I have to also tell it how to do several other things for which I really just want the default behavior.</strong></p>
<blockquote><p>ISP violations force you to take part in yet more ceremony, supplying boilerplate implementations for details you don&#8217;t wish to customize.</p></blockquote>
<p>To account for this ISP violation, I first created an abstract implementation of ITestClassCommand which uses the default behavior for all these unrelated details, leaving subclasses the responsibility of only having to describe the &#8220;test method discovery&#8221; part.</p>
<p><div><script src='https://gist.github.com/3688482.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Unfortunately, the ISP violation was so significant here that xUnit <em>really, really</em> wanted me to reimplement a fairly involved feature that I never use, <a href="http://xunit.codeplex.com/wikipage?title=Comparisons#note3">IUseFixture&lt;T&gt;</a>.  I decided to give up here, instead implementing the ClassStart method to fail fast: it complains if a developer ever assumes that TestDiscoveryCommands take part in this little-used feature.</p>
<blockquote><p>ISP isn&#8217;t just about being pedantic or fearing all interfaces containing more than one method: in order to write this class properly, I had to read a great deal of xUnit&#8217;s implementation details and <em>still</em> had to gut the IUseFixture&lt;T&gt; feature.</p></blockquote>
<p>Now that TestDiscoveryCommand insulates me from the ISP violation, I can very easily sublcass <em>that</em> to introduce my own test-method-discovery logic:</p>
<p><div><script src='https://gist.github.com/3688532.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>(<em>Aside: <code>void</code> is not a type, but <code>typeof(void)</code> is a <code>Type</code>.  Yikes.</em>)</p>
<p>With these 3 classes in my test assembly, I can convert the old, high-ceremony xUnit style (zero attributes on test classes, one <code>[Fact]</code> per test method) <a href="https://github.com/plioi/rook/compare/d48039983bebd2ee3dbaf09992ad48b438392204...ff8fb1c6896d20db2cd0a2a637a744f2d8827b71">into a slightly-cleaner style</a> (one <code>[Facts]</code> attribute per test class, zero attributes on test methods).</p>
<p>Yes, I was bored.  Very, very bored.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-09-13T00:00:00-05:00" pubdate data-updated="true">Sep 13<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>


</div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
		
		
		<a class="addthis_button_tweet"></a>
		
		
		
	</div>
	
</div>


</div>
	<footer id="footer" class="inner"><div class="related-links">
	<h3>Other Headspring Sites</h3>
	<ul>
		<li><a href="http://www.headspring.com">Headspring</a></li>
		<li><a href="http://www.headspringmobile.com">Headspring Mobile</a></li>
	</ul>
</div>

<div class="related-links">
	<h3>Communities/Groups</h3>
	<ul>
		<li><a href="http://www.adnug.org">ADNUG</a></li>
		<li><a href="http://polyglotprogrammers.org">Polyglot ATX</a></li>
	</ul>
</div>

<div class="related-links">
	<h3>Open Source</h3>
	<ul>
		<li><a href="http://www.adnug.org">AutoMapper</a></li>
		<li><a href="http://polyglotprogrammers.org">Formo</a></li>
		<li><a href="http://polyglotprogrammers.org">Parsely</a></li>
		<li><a href="http://polyglotprogrammers.org">NAAK</a></li>
	</ul>
</div>

<div class="related-links">
	<h3>Events</h3>
	<ul>
		<li><a href="http://www.adnug.org">CTX Givecamp</a></li>
		<li><a href="http://polyglotprogrammers.org">Houston TechFest</a></li>
		<li><a href="http://polyglotprogrammers.org">Austin Code Camp</a></li>
	</ul>
</div>

<hr />

Copyright &copy; 2013

    Headspring Labs

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>
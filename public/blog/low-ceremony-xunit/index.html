
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Low-Ceremony xUnit - Headspring Labs</title>
  <meta name="author" content="Headspring Labs">

  
  <meta name="description" content="&#8220;High Ceremony&#8221; software includes excessive detail which distracts from the essential thing the coder is trying to convey. In C# for &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://headspringlabs.com/blog/low-ceremony-xunit">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Headspring Labs" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Headspring Labs</a></h1>
  
    <h2>Experiments by Headspringers!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:headspringlabs.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Low-Ceremony xUnit</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-13T00:00:00-05:00" pubdate data-updated="true">Sep 13<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>&#8220;High Ceremony&#8221; software includes excessive detail which distracts from the essential thing the coder is trying to convey.  In C# for instance, you could argue that having to place <em>all</em> methods inside classes is needless ceremony.  Your Main() method shouldn&#8217;t need that extra boilerplate, but we just Have To Do It That Way.  We have to perform that ceremony.  Developers who favor dynamic languages would find type declarations to be High Ceremony as well, and even C#ers admit this whenever they use the <code>var</code> or <code>dynamic</code> keywords.</p>
<p>High ceremony isn&#8217;t limited to language details, though.  We can be guilty of introducing it, ourselves.<!--more--></p>
<h2>Framework Ceremony</h2>
<p>Frameworks often impose ceremony of their own.  ASP.NET MVC, NUnit, and xUnit all require you to litter your code with <code>[Attribte]</code>s in order to give instructions to the framework.  The framework reflects over your code, discovers these attributes, and takes action.  Usually this is all done so that the framework will know when, during its own lifecycle, your code should be invoked.  Take a look at NUnit test fixtures:</p>
<p><div><script src='https://gist.github.com/3688610.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>We <em>want</em> to simply define a named test and make an assertion about our system.  Additionally, we have to pay the Attribute Tax so that NUnit knows which classes contain tests (<code>[TestFixture]</code>), and which methods within those classes are tests (<code>[Test]</code>).  When you take part in the rest of the NUnit fixture lifecycle, you have to litter even more attributes around like <code>[SetUp]</code>, <code>[TearDown]</code>, <code>[TestFixtureSetUp]</code>, and <code>[TestFixtureTearDown]</code>.  Since these lifecycle attributes usually decorate methods with the same name as the attribute, it gets even more pointlessly verbose:</p>
<p><div><script src='https://gist.github.com/3688440.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>xUnit avoids <em>some</em> of this by using different conventions.  Test methods are still marked with an attribute (this time, <code>[Fact]</code> instead of <code>[Test]</code>).  Instead of marking test classes with an attribute, xUnit just infers the obvious: any class with <code>[Fact]</code>s must be a test class.  Instead of setup and teardown methods, xUnit relies on idioms already common in C#: default constructors for setup, and Dispose() for teardown.</p>
<p>I&#8217;ve been using xUnit over NUnit for these reasons (however trivial they are in the context of a large project).  Still, I hate typing ceremony into a project, and it seems like xUnit&#8217;s default conventions got it backwards: why not place an attribute on the test class itself, and then just <em>assume</em> all the public methods in them are tests?</p>
<h2>Minimizing xUnit&#8217;s Ceremony</h2>
<p>One important benefit of xUnit over NUnit is that xUnit is partially customizable.  If you want to define your own alternative to <code>[Fact]</code>, you can.  Also, if you want to use your own convention for discovering which methods in a test class are actually test cases, you can define your own class-level attribute.  This custom attribute goes at the top of the test class and basically means, &#8220;Hold on xUnit, I&#8217;ll take it from here.&#8221;</p>
<p>To implement your own test-method-discovery convention, you must implement ITestClassCommand.  Unfortunately, this interface violates the <a href="http://en.wikipedia.org/wiki/Interface_segregation_principle">Interface Segregation Principle</a>: this interface is large, serving several purposes.  I&#8217;m only interested in providing a new method which says whether or not a given method is a test method.  <strong>Instead of only telling xUnit how to do that, I have to also tell it how to do several other things for which I really just want the default behavior.</strong></p>
<blockquote><p>ISP violations force you to take part in yet more ceremony, supplying boilerplate implementations for details you don&#8217;t wish to customize.</p></blockquote>
<p>To account for this ISP violation, I first created an abstract implementation of ITestClassCommand which uses the default behavior for all these unrelated details, leaving subclasses the responsibility of only having to describe the &#8220;test method discovery&#8221; part.</p>
<p><div><script src='https://gist.github.com/3688482.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Unfortunately, the ISP violation was so significant here that xUnit <em>really, really</em> wanted me to reimplement a fairly involved feature that I never use, <a href="http://xunit.codeplex.com/wikipage?title=Comparisons#note3">IUseFixture&lt;T&gt;</a>.  I decided to give up here, instead implementing the ClassStart method to fail fast: it complains if a developer ever assumes that TestDiscoveryCommands take part in this little-used feature.</p>
<blockquote><p>ISP isn&#8217;t just about being pedantic or fearing all interfaces containing more than one method: in order to write this class properly, I had to read a great deal of xUnit&#8217;s implementation details and <em>still</em> had to gut the IUseFixture&lt;T&gt; feature.</p></blockquote>
<p>Now that TestDiscoveryCommand insulates me from the ISP violation, I can very easily sublcass <em>that</em> to introduce my own test-method-discovery logic:</p>
<p><div><script src='https://gist.github.com/3688532.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>(<em>Aside: <code>void</code> is not a type, but <code>typeof(void)</code> is a <code>Type</code>.  Yikes.</em>)</p>
<p>With these 3 classes in my test assembly, I can convert the old, high-ceremony xUnit style (zero attributes on test classes, one <code>[Fact]</code> per test method) <a href="https://github.com/plioi/rook/compare/d48039983bebd2ee3dbaf09992ad48b438392204...ff8fb1c6896d20db2cd0a2a637a744f2d8827b71">into a slightly-cleaner style</a> (one <code>[Facts]</code> attribute per test class, zero attributes on test methods).</p>
<p>Yes, I was bored.  Very, very bored.</p>
</div>


  <footer>
    <p class="meta">
      
  



      








  


<time datetime="2012-09-13T00:00:00-05:00" pubdate data-updated="true">Sep 13<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://headspringlabs.com/blog/low-ceremony-xunit/" data-via="HeadspringLabs" data-counturl="http://headspringlabs.com/blog/low-ceremony-xunit/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/seamless-audit-trails-in-ravendb/" title="Previous Post: Seamless Audit Trails in RavenDB">&laquo; Seamless Audit Trails in RavenDB</a>
      
      
        <a class="basic-alignment right" href="/blog/bugs-of-omission/" title="Next Post: Bugs of Omission">Bugs of Omission &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/dry-test-inheritance/">DRY Test Inheritance</a>
      </li>
    
      <li class="post">
        <a href="/blog/the-sincerest-form-of-flattery/">The Sincerest Form of Flattery</a>
      </li>
    
      <li class="post">
        <a href="/blog/fixies-life-bicycle/">Fixie's Life Bicycle</a>
      </li>
    
      <li class="post">
        <a href="/blog/test-discovery/">Test Discovery</a>
      </li>
    
      <li class="post">
        <a href="/blog/enabling-change/">Enabling Change</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/HeadspringLabs">@HeadspringLabs</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'HeadspringLabs',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Headspring Labs -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

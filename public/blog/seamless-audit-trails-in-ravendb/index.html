
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Seamless Audit Trails in RavenDB - Headspring Labs</title>
  <meta name="author" content="Headspring Labs">

  
  <meta name="description" content="Since the basic product sold by software consultancies is consultant-time, you would expect there to be pressure (gentle or not), to put in as many &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://headspringlabs.com/blog/seamless-audit-trails-in-ravendb">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Headspring Labs" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Headspring Labs</a></h1>
  
    <h2>Experiments by Headspringers!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:headspringlabs.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Seamless Audit Trails in RavenDB</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-07T00:00:00-05:00" pubdate data-updated="true">Sep 7<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Since the basic product sold by software consultancies is consultant-time, you would expect there to be pressure (gentle or not), to put in as many billable hours as physically possible, to the detrement of quality.  Fortunately, Headspring takes the long view: excess hours this week may make this week&#8217;s revenue numbers jump, but sustainability matters more for all involved.  I first experienced this policy as a reliable 40 hour work week, but it doesn&#8217;t stop there.  When you take the long view, you respect the need to put some unbillable time towards improving your own skills.  This week, I got to take advantage of that flexibility by attending Headspring&#8217;s own <a href="http://www.headspring.com/events/ravendb-boot-camp/">RavenDB Boot Camp</a>, taught by <a href="http://coderwall.com/alonsorobles">Alonso Robles</a>.</p>
<p>When new software tools come around, they almost always claim to &#8220;Just Work&#8221;.  Even <a href="http://ravendb.net/">ravendb.net</a> makes this claim.  Real software problems tend to involve lots of competing concerns, so we should always take such claims with a grain of salt in addition to an open mind.  During the Boot Camp, I got to see a perfect example of where this &#8220;It Just Works&#8221; claim comes from.<!--more--></p>
<p>RavenDB supports plugins called <a href="http://ravendb.net/docs/server/bundles">bundles</a>.  Bundles are installed by dropping a DLL into the Plugins folder beside the server exe.  One of the bundles demonstrated during the Boot Camp was for <a href="http://ravendb.net/docs/server/bundles/versioning">Versioning writes and deletions</a>.  This bundle has quite-reasonable default behavior, so installation is just a matter of dropping the DLL into the Plugins folder.</p>
<p>We students didn&#8217;t know exactly how this audit trail would present itself to us.  How would we find the trail, inspect its contents, or revert to some older state?  To find out, we dropped the bundle in its new home and started creating and updating documents through Raven&#8217;s admin tool.  There was a collective, audible &#8220;AHA!&#8221; moment among all the students.  We were updating a document whose ID was &#8220;products/4&#8221;, and right beside it in the admin tool&#8217;s list of related documents, we started to see &#8220;products/4/revisions/1&#8221;, &#8220;products/4/revisions/2&#8221;, &#8220;products/4/revisions/3&#8221;&#8230;  A full copy of the document was being stored upon each change.</p>
<p>The unit of storage of your primary data in Raven is Just Some Document, so why not also store the audit trail as Just Some More Documents?  A completely-understandable naming convention and a little metadata is all we need to work with.  Of course, the bundle also lets you fetch the revision history from your own application, and reverting to an older state would simply be a matter of fetching the revision you want and saving it again.  <strong>The beauty here lies in how the bundle leverages Raven&#8217;s world view.</strong>  Implementing an audit trail didn&#8217;t require some fundamental change to the way Raven works, and we didn&#8217;t have to roll our own audit trail by increasing complexity in our client application.  Instead, it just used the existing Raven infrastructure.</p>
<p>Earlier, I warned that &#8220;It Just Works&#8221; claims need to stand up to competing concerns.  By allowing for this kind of low-impact behavior change, adding a Versioning feature to our application doesn&#8217;t have to compete with the rest of our application&#8217;s concerns.  We didn&#8217;t have to make some painful, sweeping change everywhere our client touched the database, and the opportunity to add a history viewer to the application itself was readily available.</p>
<p>One is an extremely small sample size, so I&#8217;ll need to experience more of these &#8220;AHA!&#8221; moments, but this does suggest that the deliberately-simple mental model promoted by Raven leaves the door open for us to seamlessly introduce features into our projects.</p>
</div>


  <footer>
    <p class="meta">
      
  



      








  


<time datetime="2012-09-07T00:00:00-05:00" pubdate data-updated="true">Sep 7<span>th</span>, 2012</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://headspringlabs.com/blog/seamless-audit-trails-in-ravendb/" data-via="HeadspringLabs" data-counturl="http://headspringlabs.com/blog/seamless-audit-trails-in-ravendb/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/get-to-know-a-developer-patrick-mcveety-mill/" title="Previous Post: Get to Know a Developer: Patrick McVeety-Mill">&laquo; Get to Know a Developer: Patrick McVeety-Mill</a>
      
      
        <a class="basic-alignment right" href="/blog/low-ceremony-xunit/" title="Next Post: Low-Ceremony xUnit">Low-Ceremony xUnit &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/dry-test-inheritance/">DRY Test Inheritance</a>
      </li>
    
      <li class="post">
        <a href="/blog/the-sincerest-form-of-flattery/">The Sincerest Form of Flattery</a>
      </li>
    
      <li class="post">
        <a href="/blog/fixies-life-bicycle/">Fixie's Life Bicycle</a>
      </li>
    
      <li class="post">
        <a href="/blog/test-discovery/">Test Discovery</a>
      </li>
    
      <li class="post">
        <a href="/blog/enabling-change/">Enabling Change</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/HeadspringLabs">@HeadspringLabs</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'HeadspringLabs',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Headspring Labs -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

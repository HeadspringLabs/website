
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Headspring Labs</title>
	<meta name="author" content="Headspring Labs">

	
	<meta name="description" content="A couple of years ago, I started working with a client on a system that worked as an integration point and decision engine for a large, nationwide &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Headspring Labs" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Headspring Labs</a></h1>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/open-source">Open Source</a></li>
	<li><a href="/team">The Team</a></li>
	<li><a href="/about-us">About Us</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:headspringlabs.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/HeadspringLabs" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/HeadspringLabs" title="GitHub">GitHub</a>
		
	    
		
		<a class="coderwall" href="https://coderwall.com/team/headspring" title="Coderwall">Coderwall</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:headspringlabs.com">
	</form>
</nav>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/open-source">Open Source</a></li>
	<li><a href="/team">The Team</a></li>
	<li><a href="/about-us">About Us</a></li>
</ul>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/how-to-integrate-with-other-systems-reliably/">
		
			How to Integrate With Other Systems Reliably</a>
	</h2>
	<div class="entry-content">
		<p>A couple of years ago, I started working with a client on a system that worked as an integration point and decision engine for a large, nationwide brick-and-mortar store that was just beginning to introduce a customer loyalty program (think like Best Buy Rewards).</p>
<p>The system built was like the ones I’ve always built, with the caveat that there was very little in terms of a user interface. Instead, customers never interacted directly with the application, and we received notices of external events (and then notified others) through a variety of integration patterns, including:</p>
<ul>
<li>Producing flat files</li>
<li>Consuming flat files (CSV, XML etc.)</li>
<li>Consuming 3rd party webservices</li>
<li>Exposing web services to 3rd parties</li>
</ul>
<p>This system had to consume a lot of information that it didn’t originate, and there was a lot of potential for failures all up and down the line. Just about everything in the system was done synchronously, and not much could easily (if at all) recover from any kinds of failures or downtime.</p>
<p>We had files we would process that would sometimes get halfway through, something would mess up, and we’d have to process the file over again. But what about all those records we already processed? Even if we had ways to figure out what was processed and what wasn’t, we would have to re-process a million lines in the file before finding the record  that was the next one to process.</p>
<h3>Dealing with failures</h3>
<p>One of the critical files we received were customers that went into the stores to sign up for the loyalty program. Customers would provide their email address, the stores would collect them, and hand them to our system for processing. We would take the emails, make sure that there weren’t already anyone associated with that email address, and send the member an email.</p>
<p>It was a lot more complicated than that, and currently we communicate with two separate customer management systems through a dozen or so web service calls to fully enter a new member into the system. What became complicated was that each of these processors was essentially a giant “foreach” loop, chugging through the file and doing things. But what would happen if the web services went down? Or the server restarted? Or we needed to deploy the system?</p>
<p>We would have to wait until all these critical processes were done to deploy. If it was interrupted, we often dropped files, and no matter how much proactive saving we did, we always lost records. You know that guy that hits “Save” in Microsoft Office obsessively? That’s what we tried to do.</p>
<h3>Coupling, coupling everywhere</h3>
<p>Eventually, our system came to make many critical decisions throughout processing. For example, new enrollees, if it was close to your birthday, would receive a birthday reward. Issuing rewards could get complicated, however, since we needed to make sure that what we generated satisfied all the guidelines for the POS systems (unique coupons/barcodes, etc.).</p>
<p>However, the act of issuing a reward to someone during registration was fairly rare, but also fairly expensive. We have to do work to make sure we don’t double-issue and the like. But because we didn’t really have a way to signal that “a reward needed to be issued”, and not slow down the registration processing.</p>
<p>Ultimately, we wanted separate the event of “CustomerRegistered” with the side effect of “IssueBirthdayReward”. But without some sort of messaging, we had to have it all-in-one. And all that coupling just made it hard for the system to evolve.</p>
<h3></h3>
<h3>Towards messaging</h3>
<p>Because of the brittleness of our current architecture, we decided to go towards a message-oriented approach. Why is that? For one, we were already processing what were effectively messages. Each line in the files, each web service call received already was a message. However, our existing approach was to try and process them all at once, synchronously.</p>
<p>It was fairly straightforward to imagine this system using asynchronous, durable messages for doing what we were doing in the “foreach” loop, but the question became “which technology?”. I had used MSMQ in the past, but it was EXTEREMELY painful to try and use that API directly. Even looking at other queuing technologies, I didn’t want to build a system directly on top of a queue system. Queuing systems often don’t talk about messages in terms of C# classes and the like, and products like NServiceBus and Mass Transit made it ridiculously easy to send and receive messages over a queue.</p>
<p>So where are we now? Currently, I have a system with around 20 different NServiceBus endpoints, about 10 or so separate sagas, performing operations like waking up to retrieve files from an FTP to writing files to calling web services to bulk import and export operations. It was a long journey, but we’ve seen incidences of failures drastically decrease as we brought processing into messaging. How much better? That registration file, from customer stores, had been dropping about a file a day since the program’s inception, to a total of about 500 files.</p>
<p>When we moved to messaging, not a single file has ever been skipped.</p>
<p>See how easy it is to get started with NServiceBus, check out my <a href="http://www.headspring.com/resources/videos/" target="_blank">quickstart video</a> that takes you through the steps.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-03-30T00:00:00-05:00" pubdate data-updated="true">Mar 30<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/onion-architecture-part-4-after-four-years/">
		
			Onion Architecture: Part 4 - After Four Years</a>
	</h2>
	<div class="entry-content">
		<p>In 2008, I coined a new pattern name called Onion Architecture.  You can read the previous parts here: <a href="http://jeffreypalermo.com/blog/the-onion-architecture-part-1/">part 1</a>, <a href="http://jeffreypalermo.com/blog/the-onion-architecture-part-2/">part 2</a>, <a href="http://jeffreypalermo.com/blog/the-onion-architecture-part-3/">part 3</a>.  Over these four years, I’ve spoken about this pattern at user groups, conferences, and it’s even published in one of the chapters of <a href="http://manning.com/palermo3">ASP.NET MVC in Action</a> from <a href="http://manning.com/palermo3">Manning</a>.</p>
<p>I’ve been overwhelmed by the traction this pattern name has enjoyed.  Folks from all over the country have written about and have talked about the pattern.  Some of the ones I’ve noticed are here (please comment with more – I welcome it).</p>
<ul>
<li><a href="http://ayende.com/blog/3464/onion-architecture">Ayende Rahien’s opinion on Onion Architecture</a></li>
<li><a href="http://www.cunningclinton.com/post/2011/07/19/Onion-Architecture.aspx">“Cunning” Clinton’s view</a></li>
<li><a href="http://blog.tonysneed.com/2011/10/08/peeling-back-the-onion-architecture/">Tony Sneed’s view and code sample</a></li>
<li><a href="http://stackoverflow.com/questions/tagged/onion-architecture">StackOverflow questions on Onion Architecture</a></li>
<li><a href="http://chicagoalt.net/event/july-2011-meeting-onion-architecture-with-asp-net-mvc">Matt Hidinger’s Chicago .Net User Group video presentation on OA</a></li>
<li><a href="http://stackoverflow.com/questions/9732747/what-type-of-architecture-is-this-called/9933371#9933371">One interesting StackOverflow question.</a></li>
</ul>
<p>&nbsp;</p>
<p>Back in 2008, I defined four tenets of Onion Architecture:</p>
<ul>
<li><em>The application is built around an independent object model</em></li>
<li><em>Inner layers define interfaces.  Outer layers implement interfaces</em></li>
<li><em>Direction of coupling is toward the center</em></li>
<li><em>All application core code can be compiled and run separate from infrastructure</em></li>
</ul>
<p>&nbsp;</p>
<p>Although there has been significant adoption of this pattern, I have received countless questions about how to implement it in various environments.  I mostly get asked about how it relates to domain-driven design.  First, onion architecture works well with and without DDD patterns.  It works well with CQRS, forms over data, and DDD.  It is merely an architectural pattern where the core object model is represented in a way that does not accept dependencies on less stable code.</p>
<p><a href="http://codecampserver.codeplex.com/">CodeCampServer</a> was an original sample of onion architecture, but it also grew as a sample of how to do ASP.NET MVC in various ways, how to use Portable Areas, and how to use <a href="http://mvccontrib.org">MvcContrib</a> features like input builders.  If you are just looking for onion architecture, it has too much going on.  <a href="https://bitbucket.org/jeffreypalermo/onion-architecture">I have pushed a much simpler solution</a> that represents onion architecture concepts.  I have intentionally not included a UI input form or an IoC container, which most people associate with onion architecture.  Onion architecture works just fine without the likes of StructureMap or Castle Windsor.  Please check out the code here and let me know if this presents a simple approach – that is the goal.</p>
<p>When there is enough interest, I will continue this series with more parts.  CQRS definitely deserves some addressing within this architecture, and so do object models that support task-based UIs.</p>
<p>Get the code <a href="https://bitbucket.org/jeffreypalermo/onion-architecture">here at my BitBucket repository</a>.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-03-29T00:00:00-05:00" pubdate data-updated="true">Mar 29<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/architecture/'>architecture</a>, <a class='category' href='/blog/categories/design/'>design</a>, <a class='category' href='/blog/categories/onion/'>onion</a>, <a class='category' href='/blog/categories/patterns/'>patterns</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/what-is-technology/">
		
			What Is Technology?</a>
	</h2>
	<div class="entry-content">
		<p><a href="http://www.headspring.com/2012/03/what-is-technology/frustrating-printer" rel="attachment wp-att-4418"><img class="alignleft size-full wp-image-4418" title="frustrating printer" src="http://www.headspring.com/wp-content/uploads/2012/03/frustrating-printer.jpg" alt="" width="200" height="271" /></a>I have never met a printer I liked. They break all the time, they are buggy and noisy, and cartridges are way too expensive.</p>
<p>Printers are a terrible bane on my existence, and I have made a purpose to rid myself of needing them at all. I have come to realize that I am not alone in this grievance, and going on without the need for a frustrating printer is no longer a difficult task. Google Docs, EchoSign and a whole host of other cloud-based offerings have significantly reduced our reliance on printers, and they have added years back to my life.</p>
<p>But this post isn’t <em>all</em> about how much I hate printers – it’s old news. I work for a technology company, and technology is about new news.</p>
<p>This morning I heard about an exciting new branch of technology: 3D printing. It works - unlike regular printing - and instead of making a document, it makes an object. Recently a doctor in Belgium has worked with 3D printing to create a new jaw for an elderly patient. The jaw was literally molded together with a laser printer that heats small particles of titanium in layers.</p>
<p><a href="http://www.headspring.com/2012/03/what-is-technology/jaw-made-with-printer" rel="attachment wp-att-4419"><img class="aligncenter size-medium wp-image-4419" title="jaw made with printer" src="http://www.headspring.com/wp-content/uploads/2012/03/jaw-made-with-printer-300x167.jpg" alt="" width="300" height="167" /></a></p>
<p>As I mentioned, cloud computing has changed the paper printing business as we know it, but some printing companies are willing to accept this new opportunity as a challenge to reinvent. The exciting technology in this story is not the artificial jaw. The technology is in using a 3D printer to make it.</p>
<p>The printing business is moving away from ink and paper to useable 3D objects, but they have the same message and mission: convenience. They are saving people from painful procedures which harvest bone and tissue from other parts of their body, and they are changing the landscape of artificial implant offerings to the medical community. Also, printing implants could be much cheaper than harvesting or manufacturing them. <em>That</em> is technology!</p>
<p>My point is, when it’s time to improve technology in business, or put technology in the classroom, or bring technology to nursing homes, we may not have to look very far. Overhead projectors and pocket calculators were once considered expensive technology. Be brave enough to look at what you have available. You don’t have to mask your problems with a new device. Why throw an iPad into the equation if it isn’t necessary? Instead, open yourself up to change. Look around and create technology first with people and processes.</p>
<p>So how tech savvy are you? What are some other examples of reinvented technology?</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-03-28T00:00:00-05:00" pubdate data-updated="true">Mar 28<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/bonus/'>Bonus!</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/what-is-hg-rebase/">
		
			What Is Hg Rebase?</a>
	</h2>
	<div class="entry-content">
		<p>A couple weeks ago I introduced a client developer I&#8217;m working with on a project to <a href="http://mercurial.selenic.com/wiki/RebaseExtension">Hg Rebase</a> because the work we were doing at the time didn&#8217;t really need feature branches of any kind. When I was asked how this works over the phone, I explained it the best I could on the spot, but here&#8217;s a better attempt.</p>
<h3><strong>Rebase vs Merge</strong></h3>
<p>Instead of adding several changesets and committing them on top as a &#8220;merge&#8221; commit, Rebase uses graft (essentially a cherry-pick in the git world). My typical workflow includes taking an entirely new branch and place it &#8220;on top&#8221; of another branch. After this is done, it looks more like a straight line instead of something that has been braided. As you can see by the three diagrams below. A rebase removes the unnecessary merge commit and gives you a cleaner history. This tends to be easier for people to follow and understand than the messes you can end up with after loads of merge commits all over the place.</p>
<p>[gallery link=&#8221;file&#8221; order=&#8221;DESC&#8221;]</p>
<p>For a more detailed look into Rebase, visit <a href="http://mercurial.selenic.com/wiki/RebasePlan">the official Mercurial site</a>.</p>
<p>If you&#8217;re interested in looking at the extension&#8217;s code, it can be found on BitBucket at <a href="https://bitbucket.org/astratto/rebase-soc/">https://bitbucket.org/astratto/rebase-soc/</a>. I&#8217;m glad I was asked the question about how rebase works. Learning the internal details was really helpful for me and hopefully for you too!</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-03-27T00:00:00-05:00" pubdate data-updated="true">Mar 27<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>, <a class='category' href='/blog/categories/mercurial/'>mercurial</a>, <a class='category' href='/blog/categories/source-control/'>source control</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/you-want-to-change-what/">
		
			You Want to Change What?</a>
	</h2>
	<div class="entry-content">
		<p>Change is inevitable. It is a simple fact of life which permeates into just about everything. Software development is no exception. Many software development life cycles have evolved and others have come into existence in an effort to help us deal with change. Programming languages, tools and techniques are also continuously evolving as well. Yet with all these improvements many project teams continue to struggle with change.</p>
<p>What can we do about change? The truth is change doesn’t have to be hard. There are many things we can do such as plan for change, design for change, and code for change.</p>
<p>Sounds great doesn’t it? There are actually dozens of books and a plethora of blog posts that talk about those principles.</p>
<p>If you are still reading this, then you are probably wondering how to put those principles into practice. I will share a practical example with you.</p>
<p>A short while ago, I blogged <a href="http://www.headspring.com/2012/02/i-have-frameworkcommitment-issues">about selecting a framework</a>. The premise was a real situation in which a company I was consulting for selected a framework, changed their mind, and then changed it back. The actual frameworks involved are not important. The important thing is that the change was essentially painless.</p>
<p>Here is how pain was avoided.</p>
<p>I worked on a subsystem with very well defined boundaries of responsibility. One thing the subsystem had to do was to send a message to another subsystem. That was easy enough.</p>
<p>I started working on the core domain logic of the subsystem and I reached the point where a domain object implemented the business logic that decided to send a message to the other subsystem. The details of the message format and content were still fuzzy and that was a clear indicator that change was coming. Anticipating change here, I decided to use an interface to allow me to continue developing the business logic while the details of the messages were in limbo.</p>
<p>My code looked something like this:</p>
<p><div><script src='https://gist.github.com/1979430.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>I used unit tests to make sure the business logic was sound and leveraged a mocking framework to mock the message publisher. Shortly thereafter a decision was made to implement a third party message bus to handle some of the messaging details. Again this was easy enough to do. We just implemented the IMessagePublisher interface.</p>
<p><div><script src='https://gist.github.com/1979561.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>I ended up using a dependency injection framework to inject a MessagePublisher instance into the BusinessObject during runtime. We were also able to use a combination of unit tests and integration tests to make sure the third party message bus worked correctly. The key thing to take away here is that this MessagePublisher class and a couple of supporting classes (omitted from the code sample) were the only places where the third party code touched our subsystem.</p>
<p>When the client decided to change to another third party message bus, we only had to change one class.</p>
<p><div><script src='https://gist.github.com/1979613.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Honestly, it was a little more involved. There were a couple of other classes involved that handled the set up and configuration of the third party message bus. But the net effect of the change was limited to about three small classes, a few unit tests, and a few integration tests.</p>
<p>When the client decided to change back to the original third party message bus, I just recovered the previous implementation, unit tests, and integration tests from source control.</p>
<p>It was pretty much painless.</p>
<p>Granted not all changes are this easy. But when we plan, design, and code with change in mind we end up in a position where we can respond to change.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-03-26T00:00:00-05:00" pubdate data-updated="true">Mar 26<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>, <a class='category' href='/blog/categories/agile/'>agile</a>, <a class='category' href='/blog/categories/clean-code/'>clean code</a>, <a class='category' href='/blog/categories/code-for-change/'>code for change</a>, <a class='category' href='/blog/categories/dependency-injection/'>dependency injection</a>, <a class='category' href='/blog/categories/interface/'>interface</a>, <a class='category' href='/blog/categories/mocking-frameworks/'>mocking frameworks</a>, <a class='category' href='/blog/categories/source-control/'>source control</a>, <a class='category' href='/blog/categories/test-driven-development/'>test-driven development</a>, <a class='category' href='/blog/categories/unit-testing/'>unit testing</a>


</div>
	
</div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/32/" class="prev">Prev</a>
    
    
        <a href="/blog/page/34/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Headspring Labs

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>

<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Headspring Labs</title>
	<meta name="author" content="Headspring Labs">

	
	<meta name="description" content="In a conversation about large software projects, the word &#8220;architecture&#8221; is bound to come up sooner or later. Most programmers have a &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Headspring Labs" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Headspring Labs</a></h1>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/open-source">Open Source</a></li>
	<li><a href="/team">The Team</a></li>
	<li><a href="/about-us">About Us</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:headspringlabs.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/HeadspringLabs" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/HeadspringLabs" title="GitHub">GitHub</a>
		
	    
		
		<a class="coderwall" href="https://coderwall.com/team/headspring" title="Coderwall">Coderwall</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:headspringlabs.com">
	</form>
</nav>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/open-source">Open Source</a></li>
	<li><a href="/team">The Team</a></li>
	<li><a href="/about-us">About Us</a></li>
</ul>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/architecture-resists-change/">
		
			Architecture Resists Change</a>
	</h2>
	<div class="entry-content">
		<p>In a conversation about large software projects, the word &#8220;architecture&#8221; is bound to come up sooner or later.  Most programmers have a gut feeling for what this really means with regard to software, but if you asked 10 programmers to define it, you&#8217;d get 10 different answers.</p>
<p>In <a href="http://martinfowler.com/ieeeSoftware/whoNeedsArchitect.pdf">Who Needs an Architect?</a>, Martin Fowler covers a few definitions which he ultimately boils down to one simple concept: <strong>architecture is the decisions that are hard to change.</strong></p>
<p>Depending on the tone you use when reading that definition, it&#8217;s almost a <em>pejorative</em>.  Joel Spolsky even warned us of <a href="http://www.joelonsoftware.com/articles/fog0000000018.html">Architecture Astronauts</a>, people who effectively over-engineer and abstract things to the point that they&#8217;re no longer solving real problems.</p>
<p>Yes, <strong>an</strong> architecture can be bad.  If the decisions that are hard to change form obstacles between you and the true goal of your project, you&#8217;ve got a bad architecture.  On the other hand, some decisions that are hard to change may be a driving force for your success.  It&#8217;s just important to be aware of which decisions form your architecture as you make them.</p>
<h2>Example: The Onion Architecture</h2>
<p>With the <a href="http://www.headspring.com/2012/03/onion-architecture-part-4-after-four-years">Onion Architecture</a>, the hard-to-change decision is to define realtively-unstable infrastructure on the outside, depending on a core application that is ignorant of infrastructure details like persistence.</p>
<p>This decision is hard to change, but it is justified.  As Jeffrey Palermo said during a presentation on the O.A., an assembly is only as stable as its least-stable dependency.  Therefore, for an application to stand the test of time, we need to maximize the stable portion and minimize our dependency on things that are too likely to change.  If your app integrates with Twitter today, it likely won&#8217;t in 5 years after Twitter goes the way of the blue Dodo bird, so you are better off defining your Twitter integration outside of the core assembly, dependent on the core assembly rather than the other way around.</p>
<h2>Example: Parsley</h2>
<p>A few months back I described a hobby project to illustrate <a href="http://www.headspring.com/2011/11/recognizing-covariance-issues-in-your-code">covariance issues</a>.  This project lets you parse text by describing what a valid input looks like (similar to regular expressions).  There were two key decisions that would be impossible to change without starting from scratch:</p>
<blockquote>
<p>First, the user would describe what a valid input looks like by gluing together tiny <a href="http://domaindrivendesign.org/node/127">side-effect-free</a> functions.<br />
  Second, I would use read-only data structures to represent progress through the input.</p>
</blockquote>
<p>These two decisions are made frequently when using functional languages, but not so much in C# projects.  Despite being unusual, I found these decisions to be extremely helpful for this kind of problem, regardless of the language used to implement it.</p>
<p>The samples contain a <a href="https://github.com/plioi/parsley/blob/0b0b1cdddab040c1513344f3b768a8c348bed138/src/Parsley.Test/IntegrationTests/Json/JsonGrammar.cs">JSON parser</a>, which amounts to describing what valid JSON looks like.  The bulk of the description is summed up in a few lines:</p>
<p><div><script src='https://gist.github.com/2495421.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Because of the two architectural decisions, all the details about tracking progress, success, and failure can be completely hidden.  The user can solve the task at hand by describing the task at hand, and the architectural decisions enable that ability.</p>
<h2>Making Your Own Decisions</h2>
<p>As you make a decision that affects your project&#8217;s structure, ask yourself, &#8220;Is this a part of our architecture?  Is it going to be hard to change later if we go forward with it?  If so, does it <em>earn the right</em> to be included anyway?&#8221;  If not, try to restructure it so that it <em>is</em> easy to change, or consider chucking it entirely.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-04-27T00:00:00-05:00" pubdate data-updated="true">Apr 27<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/mvp-vs-mvc-seeking-better-testability/">
		
			MVP vs MVC: Seeking Better Testability</a>
	</h2>
	<div class="entry-content">
		<p>There&#8217;s something nice about returning to an old design pattern. Comparing it with the pattern you&#8217;re currently using gives you new insights about both.</p>
<p>When I was writing ASP.NET WebForms apps, my team organized the UI layer with an <a href="http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93presenter">MVP (Model View Presenter)</a> pattern, preferring the Passive View variant. This allowed us to write Views that were small and lean, pulling as much logic as possible out of that untestable wasteland of UI markup and code-behind. More recently, I&#8217;ve been developing ASP.NET MVC applications (using the <a href="http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">MVC (Model View Controller)</a> pattern, naturally), and I like how my Views can be straightforward HTML with a few fill-in-the-blank spots for the data I want to display; much simpler to understand than the old WebForms server controls. But my most recent project, I wrote in <a href="http://windowsclient.net/wpf/">WPF (Windows Presentation Foundation)</a> due to some specific needs of the client, and I had to re-open the UI design pattern question. I decided on MVP, and this gave me a great opportunity to contrast the two patterns.</p>
<p>My goal in choosing <em>any</em> pattern is readable, understandable code. Even if I&#8217;m the only developer on the project, reading my own code, if six months have elapsed, it might as well have been written by someone else. Patterns inherently give structure, but more importantly, they are recognizable. Reading the code, you can spot it: &#8220;Oh! This is an MVP app. Okay, I&#8217;ll look for a Presenter class to be managing the interactions with the View. &#8230;There it is!&#8221; Future maintainers and enhancers (including your Future Self) will appreciate your consistency; patterns help you write &#8220;No Surprises&#8221; software. Both MVP and MVC meet this criterion; they are recognizable patterns, each with a distinctive fingerprint.</p>
<p>My secondary pattern-choosing criterion is testability: How well does this pattern let me cover every interesting part of my app with unit tests? While I see the value in integration tests and full-system tests, I&#8217;m strongly prejudiced against them. Integration tests are finicky, and full-system tests are slow. I&#8217;m unapologetically feisty about my unit tests. The better pattern is the one that not only makes it easy to test, but makes it <em>hard</em> to write untestable code. In other words, prefer the pattern that leads your team to fall into the &#8221;<a href="http://blogs.msdn.com/b/brada/archive/2003/10/02/50420.aspx">pit of success</a>.&#8221; MVC beats MVP on this point. Let me explain.</p>
<p>Consider a continuum, from Untestable Scary Code to Clean, Verified Code. WebForms without the rigor of an MVP pattern, with heavy reliance on the code-behind, is far on the left of that continuum. A lot of business logic and application flow control can be hidden in the least testable layer. When you apply MVP to your WebForms app, the pattern guides you to write very slim code-behind files, with methods that are usually one line long, immediately deferring to the Presenter. This is closer to the middle of the continuum, where you can test your Presenters, provided you trust your Views to remain humble and hand over control promptly. MVC, as implemented by the ASP.NET MVC framework, gives you <strong>no code-behind files</strong>. There&#8217;s no temptation to put logic into the View because there&#8217;s hardly anywhere to put it. Control logic naturally fits in the Controller, which is a plain class you can instantiate and exercise in a unit test. The easiest path produces the cleanest result. Nice.</p>
<p>Why did I use MVP at all? It&#8217;s necessary in a framework that brings the View into existence first. Both WebForms and WPF start a conversation with the user by locating and instantiating a View. The View then constructs its Presenter and injects itself into it. MVC implementations start by instantiating a Controller. Unlike MVP Views, which have to talk to their Presenters, MVC Views can remain ignorant of their Controllers, and this allows them to stay logic-free and focused on rendering the UI. When using MVP, it takes vigilance to make sure your Views never do anything interesting, anything you&#8217;ll later wish you had covered with a unit test. And anything that takes vigilance is likely to drift over time.</p>
<p>It was fun to revisit my &#8220;old&#8221; way of structuring applications, because it made me think critically about the relative merits of MVP versus MVC. I had an instinctive feeling for which one I preferred, and comparing them helped me see explicitly that MVC increases my confidence in the correctness of my team&#8217;s code.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-04-25T00:00:00-05:00" pubdate data-updated="true">Apr 25<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/design-patterns/'>design patterns</a>, <a class='category' href='/blog/categories/mvp/'>mvp</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/q1-2012-company-offsite-hula-hut-and-a-boat-ride/">
		
			Q1 2012 Company Offsite: Hula Hut and a Boat Ride</a>
	</h2>
	<div class="entry-content">
		<p>Last Friday the whole Headspring gang got together for one of our quarterly company excursions.  This afternoon began on the beautifully serene dock at Hula Hut, where we chowed down on a delicious fajitas bar.  After lunch, we went over new policies, promotions and awards,  and Jeffrey led open discussion on how to identify and improve our strengths as a company.  Then we moved on to our Riverboat cruise, to relax, share a few beers and enjoy the breezy weather.</p>
<p>For your viewing pleasure:</p>
<p><a href="http://www.headspring.com/2012/04/q1-2012-company-offsite-hula-hut-and-a-boat-ride/offsite-4-20" rel="attachment wp-att-4982"><img class="alignnone size-full wp-image-4982" title="Offsite 4-20" src="http://www.headspring.com/wp-content/uploads/2012/04/Offsite-4-20.jpg" alt="" width="528" height="352" /></a></p>
<p style="text-align: center;"><a href="http://www.headspring.com/2012/04/q1-2012-company-offsite-hula-hut-and-a-boat-ride/offsite3-4-20" rel="attachment wp-att-4985"><img class="size-full wp-image-4985 aligncenter" title="offsite3 4-20" src="http://www.headspring.com/wp-content/uploads/2012/04/offsite3-4-20.jpg" alt="" width="298" height="448" /></a></p>
<p style="text-align: center;"><a href="http://www.headspring.com/2012/04/q1-2012-company-offsite-hula-hut-and-a-boat-ride/offsite9-4-20" rel="attachment wp-att-4988"><img class="size-full wp-image-4988 aligncenter" title="offsite9 4-20" src="http://www.headspring.com/wp-content/uploads/2012/04/offsite9-4-20.jpg" alt="" width="298" height="448" /></a></p>
<p style="text-align: center;"><a href="http://www.headspring.com/2012/04/q1-2012-company-offsite-hula-hut-and-a-boat-ride/offsite5-4-20" rel="attachment wp-att-4989"><img class="alignnone size-full wp-image-4989" title="offsite5 4-20" src="http://www.headspring.com/wp-content/uploads/2012/04/offsite5-4-20.jpg" alt="" width="448" height="298" /></a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-04-24T00:00:00-05:00" pubdate data-updated="true">Apr 24<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/small-talk-and-big-news/'>Small Talk &amp; Big News</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/increasing-development-enjoyment-with-ravendb/">
		
			Increasing Development Enjoyment With RavenDB</a>
	</h2>
	<div class="entry-content">
		<p>We have a lot of different options for data storage and retrieval available today. These options include the traditional relational database, document databases, key value stores, and even flat files. Every option has its benefits over the others, making some options better for some things and other options better for other things. Once the data storage and retrieval option is selected, we then typically have to select a product. Within a solution space, most products offer some distinction from their competitors. Such distinctions make certain products popular choices for a particular technology stack. For example, MySQL is a common choice for the LAMP stack, as is Microsoft SQL Server for the .NET stack.</p>
<p>Why is this so? There are several reasons for this, and their importance varies between administrators, developers, managers, and even executives.</p>
<p>From a developer&#8217;s point of view, it comes down to whether or not the product in the solution space makes the work more enjoyable.</p>
<p>As a .NET developer, <a href="http://ravendb.net">RavenDB</a> is a ton of fun to work with. Here is what it offers me:</p>
<ol>
<li>RavenDB is available as a <a href="http://nuget.org">NuGet</a> package, which means I don’t even have to leave Visual Studio to start working with it.</li>
<li>The .NET client is very well designed and supports the IQueryable interface and LINQ very well.  This makes storing, deleting, and loading data easy. It also makes querying data easy and extremely powerful.</li>
<li>Facilities to quickly define indexes and even MapReduce queries in code with minimal effort are supported.</li>
<li>The amount of time I spend on the data model is greatly reduced, since mapping .NET objects to JSON documents is easy.</li>
<li>I don’t have to use an object relational mapper (ORM).</li>
<li>An HTTP API is available as an integration option.</li>
<li>I can completely embed RavenDB in my application.</li>
</ol>
<p>The net result is I can spend most of my time focused on my application and its problem space. Reasons 4 and 5 are also true for other document databases, but reasons 1, 2, and 3 really distinguish RavenDB in the .NET space.</p>
<p>Let’s look at an example. Take for instance reason #4 and assume we were tasked with creating a domain model for a shopping cart and the persistence logic for it.  The very first thing we would do is create the domain model. After some conversations and collaboration with a stakeholder, we come up with the following initial domain model along with the unit tests which validate the correct behavior of the model:</p>
<p><div><script src='https://gist.github.com/2399488.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>At this point we are ready to start working on persisting the shopping cart object to a database. If we are using Microsoft SQL Server, we would now have to create some tables in SQL or perhaps use a code-first approach with our ORM of choice. We may need to create a map for our ORM and probably a repository class to facilitate the storage and retrieval of our domain object to and from the database. If we are using RavenDB, we are pretty much done. Regardless of the data storage solution selected, we can usually count on some tweaks and enhancements during the demo and develop iterations with the stakeholder. But when RavenDB is used, those changes are going to happen here in the domain model. Contrast this with a traditional relational database, which may require changes to the domain model, ORM maps, repositories, and SQL tables.</p>
<p>I can’t get over how easy the .NET client is to use and how powerful RavenDB can be. If you are interested in trying RavenDB out, check out my <a href="http://www.headspring.com/2012/03/getting-started-with-ravendb">Getting Started with RavenDB</a> post for a quick introduction.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-04-23T00:00:00-05:00" pubdate data-updated="true">Apr 23<span>rd</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>, <a class='category' href='/blog/categories/productivity/'>productivity</a>, <a class='category' href='/blog/categories/ravendb/'>ravendb</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/from-webforms-to-mvc/">
		
			From WebForms to MVC</a>
	</h2>
	<div class="entry-content">
		<p>Most of my first job out of college was spent doing desktop development, some of which was in VB6.  I didn&#8217;t love it, but it was easy to learn.  When <em>this</em> button is clicked, <em>that</em> function runs in response to it.  Easy.</p>
<p>The controls-and-event-handlers model combined with the language also made it exceptionally easy to create a tangled pile of misplaced responsibilities, but I think you&#8217;ve got to experience that kind of pain before you can see that alternatives even <em>exist</em>.  Once you&#8217;ve felt the pain, you can better-evaluate which guidance is actually going to be helpful.
</p>
<h2>WebForms Was Designed for Desktop Developers</h2>
<p>Right around that time, .NET was released.  ASP.NET WebForms shared little with classic ASP.  The primary goal was to let desktop VB developers make a smooth transition to both .NET and web development at the same time.  With that goal in mind, WebForms provided a similar controls-and-event-handlers model.  Making a web app felt like making a desktop app.</p>
<p>In order to support that approach, WebForms had to make the stateless world of HTTP <em>feel</em> stateful.  View State, the Page Life Cycle, and event handlers allowed the developer to go through the familiar motions of dropping controls onto a designer and wiring up methods to control events, <em>all while ignoring everything that was actually happening</em>.</p>
<p>Abstractions leak, though, and this was a <em>huge</em> abstraction.  It helped me get over the initial hurdle to get a web app up and running, but I found the code I wrote was suspiciously like the desktop VB6 mess I&#8217;d wanted to grow beyond.  I was frequently surprised by the effects of the Page Life Cycle, and every time that happened I had to learn a little bit more about how the abstraction worked under the hood:</p>
<blockquote><p>
  &#8220;Oh! There&#8217;s a Big Honking &lt;form&gt; Tag for the whole page, and it contains an Enormous Encoded &lt;input&gt; Tag containing the current state of all the controls, so whenever I need to hit a button click handler I&#8217;m really submitting a normal HTML form and then…&#8221;
</p></blockquote>
<p>Ugh. Eventually, you just have to know what HTML and HTTP are, even when using WebForms, so the abstraction was no longer helping.</p>
<h2>Many Page Life Cycles Later&#8230;</h2>
<p>While working for a previous employer, ASP.NET MVC came out.  We wanted to try out the new approach, and the timing coincided with a new project that was starting up.  However, there wasn&#8217;t much guidance available yet on how to do it <em>well</em>.  We were challenged at first by the lack of View State, and in order to keep our old &#8220;stateful stateless web&#8221; habit going we ended up storing a <em>lot</em> of things into the user&#8217;s session object.  We also kept treating controller actions like they were event handlers, leading to some awkward-looking URLs.  Distracted by these initial pains, our controllers started absorbing responsibilities like a sponge.  Actually, our <em>controller</em> started absorbing responsibilities - there was only controller in the whole app!</p>
<p>I was writing a lot of controller actions like this:</p>
<p><div><script src='https://gist.github.com/2410072.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>What I saw was the same thing I saw in WebForms development.  The Controller was the new Code Behind, and I was underwhelmed.  WebForms&#8217;s Page Life Cycle and View State hurt, but the real daily pains came from working with classes that were growing out of control, and I was seeing the same thing with my MVC code.  It seemed like the abstractions were lighter-weight, and it felt right to work with HTML more directly, but I was definitely missing some guidance.</p>
<h2>Turning the Corner</h2>
<p>Several coworkers got to take an <a href="http://www.headspring.com/services/developer-training/mvc-bootcamp">MVC Boot Camp</a> course here at Headspring, and I got to learn by osmosis from them upon their return.  At last, I had a good picture in my head of what it looks like when you&#8217;ve succeeded with these tools.  Our controllers started to get much more lean:</p>
<p><div><script src='https://gist.github.com/2416902.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>I started to see how the <a href="http://jeffreypalermo.com/blog/the-onion-architecture-part-1/">Onion Architecture</a>, dependency injection, model binders, AutoMapper, and the like help you to keep your controllers small.  MVC wasn&#8217;t a silver bullet; its primary benefit compared to WebForms was that you could make it <em>get out of the way</em> so you could actually start laying down a solid architecture.</p>
<p>ASP.NET MVC has been around for a few years now.  Community contributions like <a href="http://mvccontrib.codeplex.com/">MvcContrib</a> helped to motivate change in subsequent releases, and now ASP.NET MVC is legitimately open-sourced.  Better-yet, guidance on how to do this well has had years to mature.</p>
<p>MVC is a sharper tool than WebForms.  It acknowledges the reality of web technologies like HTML and HTTP, while providing some reasonably-sized abstractions on top of that, such as routing and model binding.  Having a better tool in your toolbelt isn&#8217;t enough, though.  You have to see what it looks like when used correctly.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-04-20T00:00:00-05:00" pubdate data-updated="true">Apr 20<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>


</div>
	
</div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/28/" class="prev">Prev</a>
    
    
        <a href="/blog/page/30/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Headspring Labs

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>
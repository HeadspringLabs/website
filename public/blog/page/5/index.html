
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Headspring Labs</title>
	<meta name="author" content="Headspring Labs">

	
	<meta name="description" content="A few weeks back, I introduced the idea of Code Whittling, in which you actively remove code from an unfamiliar project in order to learn about it &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Headspring Labs" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Headspring Labs</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:headspringlabs.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/HeadspringLabs" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/HeadspringLabs" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:headspringlabs.com">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/whittling-parsley/">
		
			Whittling Parsley</a>
	</h2>
	<div class="entry-content">
		<p>A few weeks back, I introduced the idea of <a href="http://www.headspring.com/patrick/code-whittling/">Code Whittling</a>, in which you actively remove code from an unfamiliar project in order to learn about it and discover its most interesting core functionality.  I used this technique to learn about 3 open source projects: <a href="http://www.headspring.com/patrick/whittling-rhino-licensing/">Rhino Licensing</a>, <a href="http://www.headspring.com/patrick/whittling-xunit/">xUnit</a>, and <a href="http://www.headspring.com/patrick/whittling-nunit/">NUnitLite</a>.  I&#8217;ve got one more open-source project I&#8217;d like to apply this to, but in a <em>Shyamalanian twist</em> I&#8217;ll use this approach to teach something about one of my <em>own</em> projects, instead of using it to learn about someone else&#8217;s project.</p>
<p>I&#8217;ve written about <a href="https://github.com/plioi/parsley">Parsley</a> here before: it&#8217;s a library that lets you declaratively parse complex text patterns, like a super-duper regex.  This week, we&#8217;ll tear this project down to get to the nuts-and-bolts of text traversal and pattern recognition, and next week we&#8217;ll rebuild some of the layers destroyed along the way.  We&#8217;ll discard the high-level useful bits this week, revealing a simple-yet-frustratingly-verbose core, so that next week we can reintroduce the layers that make it ultimately useful and terse.  We can make an analogy with C versus assembly: you don&#8217;t want to write assembly, even though that is the truth happening under the surface, but you&#8217;ll better-understand C once you&#8217;ve seen assembly.</p>
<h2>A Little Background</h2>
<p>If .NET didn&#8217;t already have an excellent <a href="http://json.codeplex.com/">JSON parsing library</a>, for instance, and someone needed your app to inspect and make use of some JSON as input, you might first reach for some kind of enormously complex regex, only to run into trouble describing the recursive nature of JSON (JSON objects can contain JSON objects (within JSON objects (within JSON objects))).  Regexes aren&#8217;t quite powerful enough to describe such patterns, and even if a complex regex is enough to handle your parsing needs, interpreting the results of a regex with multiple returned groups can be tedious.</p>
<p>Instead, you could use a library like Parsley to simply describe what a valid JSON string <em>looks</em> like, as well as describe how each part of JSON corresponds with your own classes.  Then, the library does the heavy lifting for you.  For instance, <a href="https://github.com/plioi/parsley/blob/cb69098da8135f7ac5fb1b0f84071e0e8b94b8a0/src/Parsley.Test/IntegrationTests/Json/JsonGrammarTests.cs">Parsley&#8217;s integration tests</a> contain a <a href="https://github.com/plioi/parsley/blob/cb69098da8135f7ac5fb1b0f84071e0e8b94b8a0/src/Parsley.Test/IntegrationTests/Json/JsonGrammar.cs">JSON parser</a> which produces .NET bools, decimals, strings, arrays, and dictionaries when given an arbitrary JSON string as input.</p>
<p>Parsley is an <a href="http://martinfowler.com/bliki/DomainSpecificLanguage.html">internal DSL for creating external DSLs</a>, so the normal use case involves simply declaring what successful input looks like, at a high level:</p>
<p><div><script src='https://gist.github.com/4688571.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<h2>High-Level Architecture</h2>
<p><a href="http://www.headspring.com/wp-content/uploads/2013/02/ParsleyArchitecture.png"><img src="http://www.headspring.com/wp-content/uploads/2013/02/ParsleyArchitecture-466x165.png" alt="Parsley Architecture" width="466" height="165" class="aligncenter size-medium wp-image-6369" /></a></p>
<p>Parsley can be broken down into 2 distinct subsystems: tokenization and grammars.  The grammar subsystem includes a low-level means of processing the input as well as a high-level DSL to make it all pretty like the example above.</p>
<p>In a tokenization phase, a JSON string like &#8220;[1, 10, 100]&#8221; is chopped up into a series of substrings: &#8220;[&#8220;, &#8220;1&#8221;, &#8220;10&#8221;, &#8220;100&#8221;, and &#8220;]&#8221;.  Note that tokens can be multiple characters, as long as they represent a single meaningful thing in JSON.  A token could be an operator, a keyword, a number, or a whole quoted string literal.  Cutting any of these things into a smaller substring would remove its meaning, so we say &#8220;that&#8217;s small enough&#8221; and stop there.  We also remember what <em>kind</em> of token each substring is, so in our example the tokenizer really turns &#8220;[1, 10, 100]&#8221; into (&#8220;[&#8220;, OpenArray), (&#8220;1&#8221;, Number), (&#8220;,&#8221;, Comma), (&#8220;10&#8221;, Number), (&#8220;,&#8221;, Comma), (&#8220;100&#8221;, Number), (&#8220;]&#8221;, CloseArray).</p>
<p>This collection of token objects is then handed off to the second subsystem, in which a grammar for our language is declared.  Parsley takes the collection of tokens, applies the grammar to it, and out pops plain old .NET objects like arrays, dictionaries, or instances of your own classes.</p>
<p><strong>My goal today is to reveal that low-level processing within the grammar subsystem.  To get there, we&#8217;re going to have to whittle away a most of the project:</strong></p>
<p><a href="http://www.headspring.com/wp-content/uploads/2013/02/WhittledParsleyArchitecture.png"><img src="http://www.headspring.com/wp-content/uploads/2013/02/WhittledParsleyArchitecture-466x164.png" alt="Whittled Parsley Architecture" width="466" height="164" class="aligncenter size-medium wp-image-6370" /></a></p>
<h2>The Whittle - Removing the Tokenizer Subsystem</h2>
<p>I started by creating a new clone of https://github.com/plioi/parsley.git.</p>
<p>As with the last three weeks, the first thing I got rid of was the unit testing project.  We&#8217;re about to start throwing away things left and right, and the tests were just going to be in the way.</p>
<p>Next, I focused on removing the entire tokenization subsystem.  I deliberately made it so that you could use the grammar subsystem without the tokenizer subsystem.  There are very real reasons why the default tokenizer wouldn&#8217;t be enough for your needs: Python&#8217;s significant indentation, for instance, requires that you maintain some extra state and make some extra decisions along the way just to produce meaningful tokens.  Since I wanted a simple tokenizer that would work for most people, and also wanted to leave the door open for Python-style gymnastics, you can provide your own drop-in replacement tokenizer: anything that produces a collection of Token objects will satisfy the grammar subsystem.</p>
<p>Tokenizing isn&#8217;t the interesting part.  If we inspect the next few characters in the input, surely we can decide whether we&#8217;re looking at a word, or an operator, or whatever.  We could go through the details, but it wouldn&#8217;t be surprising or enlightening.  To kill off the default tokenizer, I removed several classes we can ignore for the rest of today&#8217;s discussion: I dropped Lexer, which does the string-chopping action, as well as some classes that lived only to serve Lexer.</p>
<blockquote><p>At this point, the tokenizer subsystem was dead, may it rest in pieces.</p></blockquote>
<h2>The Whittle - Removing the DSL</h2>
<p>This left me with the right-hand side of the archtecture diagram above.  Time to whittle away anything that contributes to the high-level DSL seen in the JSON example grammar above.  I won&#8217;t belabor the point by listing all the classes that got removed in this step.  We&#8217;ll revisit them next week when we see how they build on top of the low-level pattern recognition code.</p>
<h2>Core Pattern-Recognition Classes</h2>
<p>Only a few classes survived this attack, representing the bottom-right portion of the architecture diagram.</p>
<p><strong>Token</strong> - Recall that the tokenizer subsystem&#8217;s job is to turn the input string into a collection of these Token objects.  They are our input.  It&#8217;s easier to work with these than to work with the original raw input string.  A token is a string like &#8220;100&#8221;, a position like &#8220;row 1, col 3&#8221;, and a TokenKind like &#8220;Number&#8221;:</p>
<p><div><script src='https://gist.github.com/4688648.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p><strong>Position</strong> - This class is a pair of integers representing the line # and column # that a token was found at.  It inherits from Value, which just provides a basic equality and GetHashCode implementation:</p>
<p><div><script src='https://gist.github.com/4688659.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p><strong>TokenKind</strong> - When you use Parsley to define your tokenizer phase, you provide a list of TokenKind objects.  If you&#8217;re making a JSON parser, you create an instance for each operator, each keyword, one for Number, one for Quotation&#8230; Each TokenKind also knows how to recognize itself in the raw input; a TokenKind representing variable names in the language you are parsing will be able to look at the raw input and say &#8220;Yes, the next 6 characters are a variable name,&#8221; or &#8220;Nope, the next few characters are not a variable name.&#8221;  Since the string-recognizing methods are irrelevant outside of the tokenizer phase, I&#8217;ve omitted them here:</p>
<p><div><script src='https://gist.github.com/4688687.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p><strong>TokenStream</strong> - Admittedly weird, <a href="https://github.com/plioi/parsley/blob/cb69098da8135f7ac5fb1b0f84071e0e8b94b8a0/src/Parsley/TokenStream.cs">TokenStream</a> takes the arbitrary collection of Tokens produced by the tokenizer subsystem and presents them to the grammar subsystem in a way that provides traversal without needing state change.  If you ask this to advance to the next token, <em>the object doesn&#8217;t change</em>; instead you get a new TokenStream representing everything except for the token you are advancing beyond.  This action resembles the <code>Skip(int) IEnumerable</code> extension method.  Rather than dwell on the weird implementation, it&#8217;s easier to just see its usage within <a href="https://github.com/plioi/parsley/blob/cb69098da8135f7ac5fb1b0f84071e0e8b94b8a0/src/Parsley.Test/TokenStreamTests.cs">TokenStreamTests</a>.  When you have a TokenStream containing the tokens &#8220;[&#8220;, &#8220;10&#8221;, and &#8220;]&#8221;, and you call .Advance(), you&#8217;ll get a TokenStream containing only the tokens &#8220;10&#8221; and &#8220;]&#8221;.</p>
<p><strong>Parser, Reply, Parsed, and Error</strong> - These are our fundamental building blocks.  A Parser is anything that consumes <em>some</em> Tokens from the stream and produces a Reply.  A Reply is either successful (Parsed), or unsuccessful (Error).  When successful, a Reply holds a Value, the .NET object you wanted to pull out of the original plain text.  Successful or not, the Reply also holds a reference to the <em>remaining, not yet consumed</em> Tokens.  A Reply basically says &#8220;I worked, and now we&#8217;re <em>here</em>,&#8221; or &#8220;I failed, and we&#8217;re still <em>there</em>.&#8221;  The whittled and simplified versions of these classes appear below:</p>
<p><div><script src='https://gist.github.com/4688743.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<h2>The Result - Tedious Pattern Recognition</h2>
<p>These classes don&#8217;t look like much, and their emphasis on zero-state-change is atypical for .NET development, but when combined they let us deliberately walk through the input Token collection, recognizing patterns along the way.</p>
<p>Let&#8217;s consider a simple example.  We want to be given a string and then decide whether or not it is a parenthesized letter like &#8220;(A)&#8221; or &#8220;(B)&#8221;.  If we&#8217;re given &#8220;(&#8220;, &#8220;(A&#8221;, &#8220;(AB)&#8221;, or &#8220;Resplendent Quatzal&#8221;, then we want to report failure.  Sure, we could do this with a regex, but any <em>simple</em> example could work with a regex.  I only need an example complex enough to show how these Parser/Reply/TokenStream classes work together.</p>
<p>Let&#8217;s assume we&#8217;ve implemented our tokenizer phase correctly already.  The tokenizer phase defined 3 TokenKind instances:</p>
<p><div><script src='https://gist.github.com/4688912.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>The tokenizer hands us the tokens to evaluate:</p>
<p><div><script src='https://gist.github.com/4688919.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>We want to write a function which receives these Token objects and tells us whether or not it is a parenthesized letter.  If it is, we want to report what the letter was.  If it isn&#8217;t, we want to tell them exactly what went wrong.  Before we do that, we&#8217;ll need to provide a useful implementation of the Parser<T> interface.  For our needs, we want a parser that produces strings on success, so that we can report what the letter was on success.  We&#8217;ll also define a convenience method for creating instances of this class:</p>
<p><div><script src='https://gist.github.com/4688947.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Finally, we have enough to write IsParenthesizedLetter(Token[]):</p>
<p><div><script src='https://gist.github.com/4688927.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Phew!  That is monotonous.  Writing this is nearly as tedious as writing assembly.  Each time I wanted to progress a little further, I had to indent again and declare some new local variables.  I had to carefully pass along the remaining unparsed tokens at each step, and I had to concern myself with failure at each step.</p>
<p>To make matters worse, this stuff motivates having lots of returns from a single function, making it extremely hard to break the function apart into smaller parts.  <a href="http://www.headspring.com/patrick/detect-reflect-decomplect/">Return statements are &#8220;Extract Method&#8221; fences</a>.</p>
<p>Consider, though, that if we wanted to concern ourselves with concepts like &#8220;the next token has to be either a Foo or a Bar or a Baz&#8221;, we could use this approach to &#8220;test the waters&#8221; as we go: Require(Foo) and if the reply was a failure, just Require(Bar) using the same original TokenStream, and if <em>that</em> reply is a failure just Require(Baz) <em>again using the same TokenStream</em>.  <strong>We get backtracking for free without having to take on the dangers of tracking some global, writable int represting our progress through the token array.</strong></p>
<p>With all the downsides, allowing backtracking in this manner doesn&#8217;t seem very worthwhile, but writing in assembly doesn&#8217;t seem very worthwhile either.</p>
<p>Next week, we&#8217;ll see how we can build a more useful, declarative API on top of these low-level pattern recognition primitives.  The suspense is killing you!</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-02-01T00:00:00-06:00" pubdate data-updated="true">Feb 1<span>st</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/headspring-announces-employee-promotions/">
		
			Headspring Announces Employee Promotions</a>
	</h2>
	<div class="entry-content">
		<p style="text-align: left;" align="center"><i>Company committed to continued growth and development of its team</i></p>
<p><b>AUSTIN, Texas, Jan., 2013</b> – Headspring, a custom software provider, is proud to announce the promotion of five employees: Justin Pope and Pedro Reys to principal consultant and Patrick Lioi, Graham Swor, and Cedric Yao to Senior Consultant 4.</p>
<p>“One of our primary objectives at Headspring is focusing on the development of our team and providing them opportunities to grow professionally,” said Dustin Wells, CEO of Headspring.” “We’re proud to give our employees well-earned promotions for their hard work.”</p>
<p>Prior to their promotions, both Pope and Reys were senior consultants and client leads. Their new role will focus on managing project teams, overseeing architectural decisions, and acting as liaison with clients. Pope joined the Headspring team in 2010 and is an expert in front-end development. Reys also joined the team in 2010 and focuses on back-end development.</p>
<p>Lioi, Swor, and Yao have been promoted to Senior Consultant 4. They are being recognized for their proactive client and company leadership, as well as their software development and project delivery skills.</p>
<p>Headspring is committed to the continued growth and development of its team. The company currently has 35 employees and hired 12 new employees within the past year.</p>
<p>&nbsp;</p>
<p><b>About Headspring                                                                                                           </b></p>
<p>Headspring delivers custom business applications to help growing companies. The Austin-based company has proudly served Texas businesses since 2001. Headspring is committed to helping local companies compete in their markets by delivering custom business applications using consultative and collaborative processes. Headspring provides customers with maintainable custom applications to fit business specific needs to enable continued growth and efficiencies. The company has been named 127 on Inc. 500, the exclusive ranking of the nation’s fastest-growing private companies. For more information, go to <a href="http://www.headspring.com">www.headspring.com</a> or call (877) 459–2260.<b></b></p>
<p align="center">

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-02-01T00:00:00-06:00" pubdate data-updated="true">Feb 1<span>st</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/press/'>Press</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/headspring-reports-year-end-results-and-projections-for-2013/">
		
			Headspring Reports Year-End Results and Projections for 2013</a>
	</h2>
	<div class="entry-content">
		<h2 style="text-align: left;" align="center"><i>67 percent growth in sales generates launch of mobile software brand and new Texas location</i></h2>
<p><b>AUSTIN, TX – (January 29, 2013) – </b>Headspring, a leading custom software development company, today announced a 67 percent growth in revenue. Headspring grew 50 percent year over year for the past two years and in 2012 exceeded its unprecedented growth cycle.</p>
<p>The company increased its client base, as well as the size and scope of its software development and consulting projects. Among Headspring’s 76 clients are government agencies, retail chains, e-commerce firms, and software vendors.  Headspring&#8217;s clients include both Fortune 500 companies and mid-market firms based in Austin, Dallas, and Houston, Texas.</p>
<p>“From day one, we focused on building a team that is creative and dedicated to top-notch results for our clients,” said Dustin Wells, CEO, Headspring. “But our success is about more than just the bottom-line, it’s about company culture.  If culture isn’t measured as a business priority, a company will lose ground quickly.”</p>
<p>To help manage its rapid growth, in June 2012, Headspring nearly tripled its office space and moved into an 11,319-square-foot headquarters building. In addition, Headspring hired 12 new employees, growing the team to 35, and promoted 17 employees.  Last year, Headspring ranked 4<sup>th</sup> of the “Best Places to Work in Central Texas” by <i>Austin Business Journal</i>, placed in the “Top 100 Best Companies to Work for in Texas” by <i>Texas Monthly</i>, and made national honors on the list of “101 Best and Brightest Companies to Work For.”</p>
<p>In 2013, Headspring forecasts continued growth and job expansion.  The company will increase the number of employees by adding 24 overall positions.  Headspring Houston will open in May, adding up to 10 team members at that location by the end of the year.  Expansion into the Houston market reflects the growing software needs of companies. One of the biggest challenges facing the industry is the need for more qualified and talented software developers.</p>
<p>“Opening an office in Houston will give Headspring the ability to attract from a broader pool of developers and also serve the increasing needs of the Houston business market,” said Glenn Burnside, vice president of engineering, Headspring.</p>
<p>In April, Headspring will launch Headspring Mobile, an independent brand focused strictly on delivering mobile application solutions. Headspring has developed a number of mobile applications under its Headspring brand, such as <a href="http://bit.ly/Vs4Tya">1<sup>st</sup> Down Technologies</a>. According to a recent report by research firm Strategy Analytics, more than 200 million mobile workers will be using mobile business applications in 2013.</p>
<p>“We are very excited about Headspring Mobile,” Wells said. “Headspring is plugged into what our customers are saying they need, and with the tremendous growth of the mobile industry, it makes sense to make this part of our product solutions.”</p>
<p><b>About Headspring:</b></p>
<p>Headspring delivers custom business applications to help growing companies. The Austin-based company has proudly served Texas businesses since 2001. Headspring is committed to helping companies compete in their markets by delivering custom business applications for growing companies. Headspring provides customers with scalable custom applications to fit business specific needs to enable continued growth. In 2009, the company was named #127 on Inc. 500, the exclusive ranking of the nation’s fastest-growing private companies. For more information, go to <a href="http://www.headspring.com/">www.headspring.com</a> or call (877) 459–2260.</p>
<p>&nbsp;</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-01-29T00:00:00-06:00" pubdate data-updated="true">Jan 29<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/press/'>Press</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/whittling-nunit/">
		
			Whittling NUnit</a>
	</h2>
	<div class="entry-content">
		<p>Last week, we applied <a href="http://www.headspring.com/patrick/code-whittling/">Code Whittling</a> to learn about <a href="http://www.headspring.com/patrick/whittling-xunit/">xUnit</a>.  This week, we&#8217;ll do the same for NUnit, and contrast the two testing frameworks.  NUnit has been around a long time, and has accumulated many features.  <a href="http://www.nunitlite.com/">NUnitLight</a> is a recent endeavor to make a smaller version of the core features.  Since my goal is to get to the core features anyway, I&#8217;ll start with NUnitLight instead of the full NUnit.</p>
<h2>The Whittle</h2>
<p>I started by grabbing a copy of the <a href="https://launchpad.net/nunitlite">NUnitLite source code on Launchpad</a>.</p>
<p>The first thing I noticed is that it has an atypical structure in Solution Explorer.  Project names include .NET version numbers (2.0, 3.5, 4.0), and these projects are placed within solution folders NET-2.0, NET-3.5, and NET-4.0.  Comparing this to the actual file structure on disk, it looks like the same code files are shared by each of these version-based projects.</p>
<p>Why have multiple projects containing the exact same files?  Viewing project properties, I see that each project has version-specific &#8220;conditional compilation symbols&#8221; like NET_2_0 or CLR_4_0 to distinguish them.  Within the code, there are lots of tests against these symbols:</p>
<p><div><script src='https://gist.github.com/4457122.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>The developers were therefore able to use one set of files to create builds for each version they will run on, accounting for the differences with these preprocessor conditions.  That doesn&#8217;t sound like fun, but keep in mind NUnit is ubiquitous, and you don&#8217;t want to be surprised by incompatibility with your environment.</p>
<p>For my purposes, I picked a single version to focus on, and removed the other versions&#8217; projects from the solution (leaving the actual shared code files intact).</p>
<p>When I whittled down xUnit last week, one of the first steps was to remove its own tests, and I did the same here with NUnitLite.  Remember, this is supposed to be a destructive exercise.  The goal is to remove everything that is in the way of my understanding the fundamentals of the project: how tests are discovered, how tests are executed, and how test results are accumulated.  I was left with a single project in the solution: nunitlite-3.5.</p>
<p>Again, as with xUnit, I removed all assertion code, since I use the <a href="http://nuget.org/packages/Should">Should</a> assertion library instead.  This was actually a much larger undertaking than with xUnit.  NUnit has been around for a long time, and the assertion library grew while keeping backward-compatibility as a priority.  It looks like a significant amount of effort went into avoiding duplication of code in the <em>implementation</em> of assertions, even while the main end-user-facing assertion APIs gained support for different styles:</p>
<p><div><script src='https://gist.github.com/4457213.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Behind this API lies a large family of classes called Constraints, which represent concepts like is-equal-to-x.  Both lines in the sample above would ultimately rely on the same constraint class to perform the comparison.</p>
<p>Next, I removed several attributes I never use, so I could instead focus on the main lifecycle attributes: [TestFixture], [TestFixtureSetUp], [TestFixtureTearDown], [SetUp], [TearDown], and [Test].</p>
<p>I made a mostly-random pass through the solution, removing things that were no longer reachable.  When interfaces eventually had a single implementation, I&#8217;d phase out the interface.  Once it got down to a manageable size, I tweaked and simplified some of the types and methods as the mood struck me.  Now that I was familiar with the overall solution structure, I took a closer look at the test discovery and execution code.</p>
<h2>Results - Test Discovery</h2>
<p>Let&#8217;s consider NUnitLiteTestAssemblyRunner to be our entry point.  Given an Assembly (a project containing tests), we want to discover and run all the tests.  I whittled it down to this:</p>
<p><div><script src='https://gist.github.com/4457272.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>It defers to NUnitLiteTestAssemblyBuilder to create <em>something</em> representing the tests to run, creates a work item to process the tests, kicks off the work item, and waits for the work item to finish.</p>
<p>NUnitLiteTestAssemblyBuilder&#8217;s job is to traverse the assembly, discover the test fixtures and their tests, and then return a TestSuite summarizing all the work that is to be done.  It does so using reflection, not surprisingly with a very similar implementation as xUnit.  I whittled NUnitLiteTestAssemblyBuilder&#8217;s pivotal method down to:</p>
<p><div><script src='https://gist.github.com/4457304.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>The CanBuildFrom(Type) method returns true if the Type has a [TestFixture] attribute or if any of its methods have a [Test] attribute.  The BuildFrom method then builds a test fixture description by reflecting on the Type&#8217;s methods, converting each test method into a Test:</p>
<p><div><script src='https://gist.github.com/4457322.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>To build a single test case, it performs a similar CanBuildFrom/BuildFrom pair as we saw for the fixture as a whole.  In this case, CanBuildFrom tests whether the given method has a [Test] attribute, and BuildFrom constructs a new TestMethod instance, which simply describes the test to be executed.</p>
<p>All of the above lets us go from a given Assembly to a tree of all the tests that need to be executed.</p>
<h2>Results - Test Execution</h2>
<p>To actually run the tests, recall that we hand that work off to something called a WorkItem.  The work item was initialized with the TestSuite (aka the test fixture) to run, and this in turn creates yet more work items, one per test.  Running one of these per-test work items takes us to TestMethodCommand.Execute(&#8230;), which I whittled down to:</p>
<p><div><script src='https://gist.github.com/4457342.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Again, much like xUnit, we use reflection to call the test method.  If an exception is thrown, that will cause the test to fail.  If no exception is thrown, we happily reach the next line and set the result to Success.</p>
<h2>Contrasting xUnit with NUnitLight</h2>
<p>NUnitLight and xUnit accomplish virtually the same thing, and from a very high level they do it in the same way:</p>
<ol>
<li>Provide an assertion API so that failed assertions present themselves as exceptions thrown from test methods.</li>
<li>Use reflection to traverse the test Assembly, building up a tree that describes what fixtures are to be executed, and which tests appear on each fixture.</li>
<li>Walk through those trees, using reflection to invoke each test method.</li>
<li>If that invocation didn&#8217;t throw an exception, consider the test passed.</li>
</ol>
<p>Despite this similarity, their implementations differ a great deal.  I thought xUnit was big, but even NUnit<em>Light</em> seems quite a bit larger.  It was really easy to remove xUnit&#8217;s assertion code, and very tough to remove NUnitLight&#8217;s.  I&#8217;m not saying &#8220;ease of destruction&#8221; should be anywhere on a developer&#8217;s radar when writing an API, but it does speak to the history of the two projects.  As I wrote earlier, NUnit&#8217;s history involves more than one user-facing API for writing assertions, and they needed to avoid duplicating implementation details; naturally the design of assertions here is more complex than with xUnit.  I started pulling the assertion thread in NUnitLight, and quickly wound up with a long series of dependencies to remove before it would compile again.</p>
<p>Before looking at either of these projects, I figured that after removing the assertion code, there would be very little left, but I was wrong.  As with anything that gets used by such a large audience, the devil is in the details.  Projects this popular have to handle many environments and situations that no single developer ever encounters on their own.</p>
<p>Although I doubt I could make a meaningfully-large contribution to these projects right away, I&#8217;m now much closer to that level of knowledge.  Passively reading through the code would not have been as effective as destroying them from the outside in.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-01-25T00:00:00-06:00" pubdate data-updated="true">Jan 25<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/headspring-forms-strategic-alliance-with-clear-measure-in-support-of-new-business-enterprise/">
		
			Headspring Forms Strategic Alliance With Clear Measure in Support of New Business Enterprise</a>
	</h2>
	<div class="entry-content">
		<h3><em style="font-size: 1.17em;">Software management company provides additional options for customers.</em></h3>
<p>&nbsp;</p>
<p><b>AUSTIN, TX – (January 24, 2013) – </b>Headspring, a leading custom software development company, today announced a strategic alliance with Clear Measure, a software management solutions company recently founded by Headspring’s former president and COO, Jeffrey Palermo. Clear Measure complements Headspring’s existing services by providing software management consulting and professional services. The alliance allows Headspring to add another option to its robust package of services for its customers.</p>
<p>Headspring has experienced rapid growth increasing revenues by more than 50 percent year over year, and in 2011 Headspring experienced a 162 percent increase in the number of clients the company served through the software development and software consulting projects. In 2012, the company added 12 new employees and plans to continue expanding opening an office in Houston, Texas in January 2013.</p>
<p>“We are committed to the continual growth and improvement of our business and our team,” said Dustin Wells, CEO of Headspring.  “This alliance exemplifies our belief that supporting our team’s growth and entrepreneurial instincts turns into exciting new opportunities. We are thrilled to support Jeffrey in this new venture.”</p>
<p>Headspring will provide Clear Measure access to expert software engineering services by developers who are recognized leaders in the industry and Clear Measure will provide management consulting and project management services such as systems assessments, data monitoring, and continual auditing.</p>
<p>“I’m thankful to be able to continue a long and fruitful relationship with Headspring,” said Jeffrey Palermo, Managing Partner &amp; CEO of Clear Measure.  “Companies rely on software for a competitive advantage. Our goal is to provide the clarity, measurement, and control that companies need to get the most of their software investments, while partnering with a company we know has the expertise to deliver forward thinking and beneficial long-term software solutions.”</p>
<p>Until recently, Jeffrey Palermo was the president and COO of Headspring.  He was instrumental in helping build Headspring’s team of talented developers and the alliance between the two companies leverages the capabilities of both to serve the growing software needs of companies.</p>
<p><b>About Clear Measure                                                                                                          </b></p>
<p>Clear Measure provides professional services and consulting that enable the clarity, measurement, and control businesses need to get the most from their software investments. Using a proven methodology, Clear Measure equips senior software executives and managers with the tools and knowledge to maximize ROI and reduce risk. For more information, go to <a href="http://www.clear-measure.com">www.clear-measure.com</a> or call 512-298-1232</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-01-24T00:00:00-06:00" pubdate data-updated="true">Jan 24<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/press/'>Press</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/no-offshoring/">
		
			No Offshoring</a>
	</h2>
	<div class="entry-content">
		<p>One of Headspring&#8217;s principle practices - which is probably not advertised nearly to the extent it should be - is that we never outsource development work. The policy was put in place early in our company history. This was right around the time we steered away from building websites for new companies and began focusing our services on delivering custom enterprise software. Sometimes it made sense to outsource, and could be more cost effective for our customers. But more often than not, it became difficult to see around corners and ensure that we were receiving quality built code.</p>
<p>We discovered the best way to create or reconstruct our clients&#8217; software is to hire the best architects, critical thinkers and code masters we could get our hands on, put them in a room together, and give them the resources they need to do great work. We refer to this collaboration as a &#8220;brain trust&#8221;. And working this way has directly affected our ability to be so successful.</p>
<h2>Looks Can Be Deceiving</h2>
<p>This morning I woke up to <a href="http://www.npr.org/blogs/thetwo-way/2013/01/16/169528579/outsourced-employee-sends-own-job-to-china-surfs-web" target="_blank">a national news story</a> about a company entrusting critical development work to a pricey developer - only to find its deluxe development package was being outsourced to a Chinese team for 1/5 of their cost.</p>
<p>The story is quite funny, actually.  The company discovered data that showed its virtual network being accessed from China. The company feared hackers had invaded the network, so they ordered an investigation from Verizon&#8217;s web security team. The VPN logs showed the originally contracted developer, while still sitting at his desk, was also accessing the network from a city in China.</p>
<p>Now, it was understood in the office that this contract developer (<a href="http://webcache.googleusercontent.com/search?q=cache:http://securityblog.verizonbusiness.com/2013/01/14/case-study-pro-active-log-review-might-be-a-good-idea/" target="_blank">the original story published on Verizon&#8217;s blog refers to him as &#8220;Bob&#8221;</a>) did great work. In fact, he was regarded as the best developer in the office, and was paid accordingly - six figures, in fact.  But after a deeper investigation, the Verizon team discovered hundreds of .pdf files detailing Bob&#8217;s communication with the outsourced firm he worked with in Shenyang China. He subcontracted the firm for 1/5 of his pay.</p>
<p>So what did Bob do while his sub-contract was hard at work? Here&#8217;s his busy schedule:</p>
<p>9:00 AM - Arrive at the office, surf Reddit.com, watch cat videos</p>
<p>11:30 AM - Take lunch</p>
<p>1:00 PM - Ebay time!</p>
<p>2:00 - ish PM - Facebook and LinkedIn updates</p>
<p>4:30 PM - End of day email to management</p>
<p>5:00 PM - Go home</p>
<h2>Who Do You Love?</h2>
<p>As it turns out, this wasn&#8217;t Bob&#8217;s first rodeo, and he didn&#8217;t invent the wheel either. Sure, he <em>delivered</em> great code, so what&#8217;s the big issue in the end? It comes down to trust.</p>
<p>We hear the same stories all the time from our prospective clients - except not usually with the same storybook &#8220;no harm done&#8221; ending that Verizon outlines in their comical case study. Nope. Usually companies aren&#8217;t aware of the security breach until there is a big problem.</p>
<p>So do yourself a favor: make absolute sure you are working with a company/contractor/development team that cares about your security and code as much as you do.</p>
<p>&nbsp;</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-01-17T00:00:00-06:00" pubdate data-updated="true">Jan 17<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/blog/'>Blog</a>, <a class='category' href='/blog/categories/bonus/'>Bonus!</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/whittling-xunit/">
		
			Whittling xUnit</a>
	</h2>
	<div class="entry-content">
		<p>Last week, we saw how <a href="http://www.headspring.com/patrick/code-whittling/">Code Whittling</a> lets you learn about an unfamiliar open-source project, using <a href="http://www.headspring.com/patrick/whittling-rhino-licensing/">Rhino Licensing</a> as an example.  This week, we&#8217;ll walk through the process I took when whittling xUnit.  xUnit is a unit testing framework similar to NUnit.  I wanted to get a feel for how a test framework really works: how it traverses your test project to discover test cases, how it executes individual test cases, how it tallies results, and how it integrates with the TestDriven.net plugin for Visual Studio.</p>
<h2>The Whittle</h2>
<p>I started by grabbing a copy of the <a href="http://xunit.codeplex.com/SourceControl/BrowseLatest">xUnit source code on CodePlex</a>.</p>
<p>Not surprisingly, this project has a lot of test coverage.  Since code whittling is decidedly <em>not</em> about safe forward development, and since unit tests pose an obstacle to quickly whittling a project down to its essentials, the first thing I removed were all the unit tests.  It&#8217;s OK, we&#8217;re not going to make any permanent changes.  This is an exercise in quick discovery, not slow-and-steady accuracy.</p>
<p>I tend to use a console test runner and a TestDriven.Net test runner, but none of the other runners.  My next victims were the projects for the runners I don&#8217;t happen to use: xunit.gui, xunit.runner.visualstudio, and xunit.runner.msbuild.</p>
<p>Since I use the <a href="http://nuget.org/packages/Should">Should</a> assertion library, I had no need for any of xUnit&#8217;s own assertion code, allowing me to remove a huge chunk of code I had no interest in.  I deleted the <a href="http://xunit.codeplex.com/SourceControl/changeset/view/2e806844c3c1#src/xunit/Assert.cs">Assert</a> class, its usages, and the many associated exception classes.</p>
<p>I generally don&#8217;t use the [Theory] attribute in my xUnit tests, so I removed that and its usages next.  Lots of support classes for [Theory] were no longer in my way.</p>
<p>I&#8217;m more interested in how results are tallied and output to the console, and less interested in any XSLT reporting of those results, so I removed all the XSLT-dependent code.</p>
<p>Then I removed a long series of features I rarely or never use: IUseFixture, skipped tests, [AutoRollback], [AssumeIdentity], [FreezeClock], [Trace], &#8230;</p>
<p><strong>Eventually, I goofed up.</strong>  It turns out there is more multithreading code and more dynamic construction (in which a string containing the name of a class is used to instantiate that class) in xUnit than I expected.  I actually expected little or no threading/dynamic stuff, but I ended up removing too much in one step, losing something fundamental in the code path between Main() and actual invocation of a test.</p>
<blockquote><p>Lesson learned: Even when creating a throwaway clone of a project, just so I can violently destroy it, commit frequently with useful comments.  If you remove too much, you can see where you went wrong and rewind.</p></blockquote>
<p>I found that I couldn&#8217;t whittle this down quite as far as I did with Rhino Licensing.  Even with the less-used features taken out, what I was left with involved a lot of classes deferring to classes which defer to classes which defer to static helper methods.  I could have taken the time to refactor this away and boil it all down to the fundamental logic I was searching for, but I was starting to get comfortable with the class naming conventions and could find my way through it clearly enough.</p>
<p>I got a good, though incomplete, understanding of xUnit, and going back to the original code is no longer the daunting task it was before.</p>
<h2>Results</h2>
<p>Test execution is broken down into two phases.</p>
<p>For <strong>Phase 1</strong>, it builds up a tree of objects representing the test methods in the test assemblies: a TestAssembly has TestClass objects, each of which has TestMethod objects.  These are discovered and constructed via reflection.  The class EnumerateTests uses reflection to discover all the types in a given Assembly, and ultimately defers to TypeUtility.GetTestMethods(&#8230;):</p>
<p><div><script src='https://gist.github.com/4438396.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Plain old reflection walks through all the methods in the test assembly, picking out the ones that are marked as tests with the [Fact] attribute.</p>
<p>For <strong>Phase 2</strong>, it traverses the tree of tests to execute them and accumulate results.  <a href="http://xunit.codeplex.com/SourceControl/changeset/view/2e806844c3c1#src/xunit/Sdk/Commands/ClassCommands/TestClassCommandRunner.cs">TestClassCommandRunner</a> has the main execution logic.  For a given class, it processes the list of method in random order.  For each method, xUnit gets one or more ITestCommands to execute.  Each test command is invoked, giving a MethodResult which gets included in the overall ClassResult.</p>
<p>A single test command to execute, for a test identified with the [Fact] attribute, looks like this:</p>
<p><div><script src='https://gist.github.com/4438431.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>A single test is executed here via Invoke(&#8230;), which is also a part of .NET reflection.  xUnit is just asking the .NET framework to call our test method for us.  Any exceptions bubble up and cause the test to fail, including exceptions thrown by Assert methods.  If no exceptions were thrown, it returns the new PassedResult representing success.  Results are hierarchical, just like the original tree of tests: AssemblyResult, ClassResult, FailedResult, and PassedResult allow us to track results at every level that a test runner may need to report on.</p>
<p><strong>Lastly, TestDriven.NET integration:</strong> TestDriven.NET requires you to implement the following interface.  Depending on how the user invokes TD.Net, one of these three methods will be called:</p>
<p><div><script src='https://gist.github.com/4438582.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>xUnit&#8217;s TdNetRunner implements this by ultimately deferring to the same test execution code that the console runner uses.</p>
<p>I was a little surprised by the size of the project, especially the use of multithreading.  A large number of features added up to a lot of things for me to remove before I could really see the fundamental code path.  This makes me curious about how NUnit compares, so next week we&#8217;ll see what we can learn by whittling down NUnit.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-01-15T00:00:00-06:00" pubdate data-updated="true">Jan 15<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/get-to-know-a-developer-jose-basilio/">
		
			Get to Know a Developer: Jose Basilio</a>
	</h2>
	<div class="entry-content">
		<p><img class="alignright size-medium wp-image-6321" alt="Jose Basilio" src="http://www.headspring.com/wp-content/uploads/2013/01/photo-2-e1357940416657-224x300.jpg" width="224" height="300" />This week we welcomed Jose Basilio to the team! Jose currently lives in Houston, but he’s originally from the Dominican Republic. I was so excited to speak with him because he told me that participating in <a href="http://www.headspring.com/mary/headspring-hosts-central-texas-givecamp-to-benefit-10-local-non-profits/" target="_blank">CTX GiveCamp</a> (one of my projects last year) convinced him to look into working for us full time. In fact, Jose was on the TX Kidney Foundation team, which won CTX GiveCamp’s highest honor: the “Meg Ryan Facelift Award for Coolest UI”. I knew he was a winner. Here’s the rest of our conversation:</p>
<p>Where did you work, and what did you do before coming to Headspring?</p>
<p>I was a senior developer at Dril-Quip, Inc., a manufacturer of oil and gas drilling equipment in Houston. Prior to that, I worked in various roles in application and database administration at Compaq / HP.</p>
<p>What or who made you want to work here?</p>
<p>Throughout my career, I have worked for companies where software was a cost-center. I wanted the opportunity to work for a company where my efforts directly contribute to the bottom-line. I also wanted work along-size like-minded individuals that have a passion for learning and moving their careers forward. I believe Headspring is that company.</p>
<p>What led you to software development?</p>
<p>Computers are better than humans at performing repetitive tasks in a fast and consistent manner. I wanted to automate my day-to-day activities as a database admin. This led me to learn scripting languages, and I enjoyed that so much that moved into full-blown development.</p>
<p>What did you learn first?</p>
<p>I started by learning VBScript to create windows scripts and dynamic web pages back in the day.</p>
<p>Do you like teaching?</p>
<p>I love teaching and learning new things. The best way to truly learn and become an expert at something is to teach it.  I think that in the process of simplifying a topic in order to teach it to others, we gain clarity of mind and reach those “aha” moments in our understanding of the subject.</p>
<p>&nbsp;</p>
<p>Want to know more? Tweet <a href="https://twitter.com/jbasilio" target="_blank">@jbasilio</a>.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-01-11T00:00:00-06:00" pubdate data-updated="true">Jan 11<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/blog/'>Blog</a>, <a class='category' href='/blog/categories/bonus/'>Bonus!</a>, <a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>, <a class='category' href='/blog/categories/get-to-know-a-headspringer/'>Get To Know a Headspringer</a>, <a class='category' href='/blog/categories/what-the-tech/'>What the tech?</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/whittling-rhino-licensing/">
		
			Whittling Rhino Licensing</a>
	</h2>
	<div class="entry-content">
		<p>Last week, I introduced a learning exercise called <a href="http://www.headspring.com/patrick/code-whittling/">Code Whittling</a>.  This week, we&#8217;ll walk through the process I took when whittling <a href="http://www.hibernatingrhinos.com/oss/rhino-licensing">Rhino Licensing</a>.</p>
<p>Rhino Licensing makes it easy for your application to enforce licenses.  If you&#8217;re making a application that needs to check which features the user has paid for, whether a trial has expired, etc, this is about as easy as it gets.  I recently needed to do this for a client, and James Gregory&#8217;s <a href="http://www.jagregory.com/writings/rhino-licensing/">Rhino Licensing tutorial</a> covers exactly the use case I cared about.  The tool, however, handles more than that use case.  I wanted to know how the basic idea worked, how a human-readable XML file could be tamper-proof, but I didn&#8217;t care about the other supported use cases.</p>
<h2>The Whittle</h2>
<p>I started by grabbing a copy of the <a href="https://github.com/hibernating-rhinos/rhino-licensing">Rhino Licensing source</a>.</p>
<p>GUI tools in support of a library don&#8217;t usually catch my interest.  Rhino.Licensing.AdminTool was a UI tool I didn&#8217;t need to work with for my use case, so it was the first to go.</p>
<p>Rhino Licensing can use trusted time servers like time.nist.gov when deciding whether a license&#8217;s expiration date has been reached, since malicious users might subvert expiration dates by changing their local system clock to some future date.  This feature is important, but was irrelevant to me in the short term: I wanted to know how the license files themselves work, and cared less about the details of reliable timekeeping.  I removed the class <a href="https://github.com/hibernating-rhinos/rhino-licensing/blob/4d77e00bfa85e8d22f966b09e340be31476afac1/Rhino.Licensing/SntpClient.cs">SntpClient</a>, the array of trusted servers within <a href="https://github.com/hibernating-rhinos/rhino-licensing/blob/4d77e00bfa85e8d22f966b09e340be31476afac1/Rhino.Licensing/AbstractLicenseValidator.cs">AbstractLicenseValidator</a>, and everything that depended on them.</p>
<p>There are several exception types declared, which is useful for communicating why a license might fail validation, but they didn&#8217;t help me in my quest to find out how the license files could be tamper-proof, so I phased them out in favor of generic Exception instances.  Likewise, logging is important, but it was just noise for my purposes, so I removed it.</p>
<p>The <a href="https://github.com/hibernating-rhinos/rhino-licensing/blob/4d77e00bfa85e8d22f966b09e340be31476afac1/Rhino.Licensing/LicenseType.cs">LicenseType</a> enum lists several kinds of licenses I was uninterested in.  I removed the ones I wasn&#8217;t interested in along with their usages.</p>
<p>Rhino Licensing has a server-side component, I believe to coordinate the sharing of license files across multiple machines.  Although interesting, this doesn&#8217;t have to do with the tamper-proofing of license file content, so I removed: LicensingService, ISubscriptionLicensingService, ILicensingService, DiscoveryHost, DiscoveryClient, and anything that depended on them.</p>
<p><a href="https://github.com/hibernating-rhinos/rhino-licensing/blob/4d77e00bfa85e8d22f966b09e340be31476afac1/Rhino.Licensing/AbstractLicenseValidator.cs">AbstractLicenseValidator</a> has two child classes: <a href="https://github.com/hibernating-rhinos/rhino-licensing/blob/4d77e00bfa85e8d22f966b09e340be31476afac1/Rhino.Licensing/LicenseValidator.cs">LicenseValidator</a> for processing a license XML file, and <a href="https://github.com/hibernating-rhinos/rhino-licensing/blob/4d77e00bfa85e8d22f966b09e340be31476afac1/Rhino.Licensing/StringLicenseValidator.cs">StringLicenseValidator</a> for processing a string of XML (for instance, you may be storing your license content in a database rather than a file).  I didn&#8217;t need a refresher course on reading file content into a string, so I removed LicenseValidator and then collapsed StringLicenseValidator into the AbstractLicenseValidator base class.</p>
<h2>Results - Signing XML Documents</h2>
<p>All this left me with a better understanding of what Rhino Licensing has to offer, while whittling the project down to the few files I <em>really</em> wanted to dig into: <a href="https://github.com/hibernating-rhinos/rhino-licensing/blob/4d77e00bfa85e8d22f966b09e340be31476afac1/Rhino.Licensing/LicenseGenerator.cs">LicenseGenerator</a>, and a now-much-much-smaller version of <a href="https://github.com/hibernating-rhinos/rhino-licensing/blob/4d77e00bfa85e8d22f966b09e340be31476afac1/Rhino.Licensing/AbstractLicenseValidator.cs">AbstractLicenseValidator</a>.  The first is responsible for generating the tamper-proof XML, and the second is responsible for parsing the tamper-proof XML and deciding whether it is legitimate.</p>
<p>James Gregory&#8217;s <a href="http://www.jagregory.com/writings/rhino-licensing/">Rhino Licensing tutorial</a> first describes a prerequisite step for creating a private/public key pair:</p>
<p><div><script src='https://gist.github.com/4435588.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>The contents of these files are basically large numbers.  The numbers are related to each other, but a malicious user would not be able to guess the private one given only the public one.</p>
<p><a href="https://github.com/hibernating-rhinos/rhino-licensing/blob/4d77e00bfa85e8d22f966b09e340be31476afac1/Rhino.Licensing/LicenseGenerator.cs">LicenseGenerator</a> is given the private one as a string to its constructor.  LicenseGenerator then generates a string of XML given a few values.  The values will all appear in plain text in the XML: name, id, expirationDate, LicenseType, and an optional set of name/value pairs specific to your needs.  The private helper method CreateDocument produces an XmlDocument containing those inputs.</p>
<p><strong>Next, the magic happens.</strong>  This simple XML document is completely open to tampering by a malicious user.  To combat our adversary, it supplements the document with an additional XML element produced by private helper method GetXmlDigitalSignature.  This method uses some .NET framework classes to take the original document and use the secret/private key to produce an encrypted version of the original weak XML document.  The new XML element basically contains yet another very large number, which corresponds with the original XML document content.  The resulting document is now tamper-proof: if a malicious user opens it and changes the expiration date to the year 2500, they would have to <em>also</em> change the big signature number to match, and <em>good luck guessing what big number corresponds with the new XML document</em>, since the malicious user doesn&#8217;t have the private key necessary to create that number quickly.  To sum up, here&#8217;s how to take an insecure XML document and make it tamper-proof with a signature:</p>
<p><div><script src='https://gist.github.com/4438155.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Once we have one of these documents, how do we read and validate them?  <a href="https://github.com/hibernating-rhinos/rhino-licensing/blob/4d77e00bfa85e8d22f966b09e340be31476afac1/Rhino.Licensing/AbstractLicenseValidator.cs">AbstractLicenseValidator</a> had been whittled down to be little more than the methods ValidateXmlDocumentLicense() and TryGetValidDocument(string licensePublicKey, XmlDocument doc).  Contrary to its name, the main thing ValidateXmlDocumentLicense does is read the original inputs from the human-readable parts of the XML file.  TryGetValidDocument does the real work, the inverse of LicenseGenerator&#8217;s digital &#8220;signature&#8221;: read the special &lt;Signature&gt; element which contains our encrypted original document, and ask the .NET framework whether it matches the rest of the document&#8217;s human-readable content:</p>
<p><div><script src='https://gist.github.com/4438179.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Creating tamper-proof yet human-readable XML files is no longer magical.  Rhino Licensing creates and validates tamper-proof license files by taking the original insecure version of the document and appending a special &#8220;content summary&#8221; element.  A malicious user would have to tamper with the human-readable part as well as the virtually-unguessable content summary in order to trick the validator, and as long as the private key is kept private, that&#8217;s certainly good-enough.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-01-08T00:00:00-06:00" pubdate data-updated="true">Jan 8<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/get-to-know-a-developer-patrick-abbs/">
		
			Get to Know a Developer: Patrick Abbs</a>
	</h2>
	<div class="entry-content">
		<p><img class="alignright size-medium wp-image-6318" title="Patrick Abbs" src="http://www.headspring.com/wp-content/uploads/2013/01/photo-1-e1357685470139-224x300.jpg" alt="Patrick Abbs" width="224" height="300" />This week we welcomed in a New Year and a new consultant to the team: Patrick Abbs.  Patrick is a native Austinite, but just moved back from New York.  He went to NYU for Individualized Study – a new type of customized undergraduate degree program. He explained to me that he chose a focus of study (Game Theory) and developed his own course schedule around it. He had to produce a senior thesis and submit it before a board, similar to the process of obtaining a graduate degree.</p>
<p>In school and in the workforce, he found programming knowledge to be very helpful in crunching data for statistical analysis. Eventually, he was led to Headspring. Read more about how that happened:</p>
<p><strong>Where did you work, and what did you do before coming to Headspring?</strong></p>
<p>My last two jobs were completely different from each other, but Headspring is interestingly kind of a mix between the two.  At the tech startup Tilde, I worked with the LAMP stack (as well as some C# and Python) to create a B-to-B tool for businesses to streamline their back-office processes.  At DRSdigital, I worked directly with new and existing clients to create, customize, and maintain secure data rooms (typically for potential merger and acquisition deals).</p>
<p><strong>Are you an expert at anything?</strong></p>
<p>I have worked extensively with algorithms geared towards statistical analysis of information sets, and am especially well-acquainted with mixture models (a more specific type of statistical algorithm).  As much as I love statistics algorithms, though, I definitely want to expand my expertise into other areas of programming.  At the moment I&#8217;m fascinated with the differences between and advantages of different types of databases, as well as with how compilers work.</p>
<p><strong>What led you to software development?</strong></p>
<p>The initial appeal of software development for me came from the recognition that once a program has been written to solve a given type of problem once, it can thereafter solve any instance of that problem an endless number of times with incredible efficiency and little effort.  For instance, it might take me two minutes to sort fifty documents according to some ordering criteria manually, versus ten minutes to write a program which executes the same sorting methodology.  However, after I have written such a program I can use it to sort any number of documents any number of times in a matter of milliseconds for each execution, all with the click of a button.  Once I started thinking about software development as something that requires some initial time investment but can save exponentially more time in the long run, I was hooked.</p>
<p><strong>What did you learn first?</strong></p>
<p>My first introduction to code was as a mathematically-oriented person trying to convey algorithms to software developers for implementation.  The fact that I had no experience with code and the developers I was working with had a limited understanding of math significantly slowed the rate at which theory could be converted to practice, so I decided to try to bridge the gap between our areas of understanding by learning the relatively simple, mathematical language Python.</p>
<p><strong>What or who made you want to work here?</strong></p>
<p>Headspring is an appealing place to work for me for several reasons.  It is known for having a great and open company culture (which I saw first-hand at the two lunch-and-learns I&#8217;ve attended).  I&#8217;m also excited about the fact that the vast majority of the people working there are seasoned, experienced professionals, and as a less experienced developer I really value being able to ask questions and learn from the experience of the people around me.</p>
<p>As far as the actual responsibilities of being a Headspring consultant, I really like the fact that the projects are diverse and let me work on a variety of different programming challenges.  Finally, I like the fact that working at Headspring often involves working directly with clients.  I love technology, but regularly interacting with clients is exciting to me.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-01-08T00:00:00-06:00" pubdate data-updated="true">Jan 8<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/blog/'>Blog</a>, <a class='category' href='/blog/categories/bonus/'>Bonus!</a>, <a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>, <a class='category' href='/blog/categories/get-to-know-a-headspringer/'>Get To Know a Headspringer</a>, <a class='category' href='/blog/categories/what-the-tech/'>What the tech?</a>


</div>
	
</div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/4/" class="prev">Prev</a>
    
    
        <a href="/blog/page/6/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Headspring Labs

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>
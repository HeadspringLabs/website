
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Headspring Labs</title>
	<meta name="author" content="Headspring Labs">

	
	<meta name="description" content="My last three posts have covered the nuts and bolts of the little-used in and out keywords: Array Covariance in C#
Seamless Generic Type Casting &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Headspring Labs" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Headspring Labs</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:headspringlabs.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/HeadspringLabs" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/HeadspringLabs" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:headspringlabs.com">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/recognizing-covariance-issues-in-your-code/">
		
			Recognizing Covariance Issues in Your Code</a>
	</h2>
	<div class="entry-content">
		<p>My last three posts have covered the nuts and bolts of the little-used <code>in</code> and <code>out</code> keywords:</p>
<ul>
<li><a href="http://www.headspring.com/2011/10/array-covariance-in-c">Array Covariance in C#</a></li>
<li><a href="http://www.headspring.com/2011/10/seamless-generic-type-casting">Seamless Generic Type Casting</a></li>
<li><a href="http://www.headspring.com/2011/11/seamless-delegate-type-casting">Seamless Delegate Type Casting</a></li>
</ul>
<p>&nbsp;</p>
<p>The examples have all been small, and a little contrived, so you may not yet recognize when you need to fetch this tool from your toolbelt. Today, I&#8217;ll cover a real covariance problem I ran into while developing <a href="http://github.com/plioi/Parsley">Parsley</a>, an open-source text parsing library.</p>
<p>The goal of parsing is to convert plain text into a data structure that can be more easily traversed and reasoned about. You want to describe the patterns of what valid input looks like, as well as describe what objects should be created when those patterns are found.</p>
<p>In today&#8217;s example, we&#8217;ll be parsing <a href="http://json.org/">JSON</a> text into the corresponding arrays and dictionaries that JSON describes. Parsley&#8217;s integration tests include <a href="https://github.com/plioi/parsley/blob/91394b0f17606aea9a583ae49249da3567c53298/src/Parsley.Test/IntegrationTests/Json/JsonGrammar.cs">a JSON parser</a>. <strong>Without the <code>out</code> keyword, this sample parser would fail to compile with some pretty suspicious error messages.</strong></p>
<p>The most important types defined in Parsley are <code>Parser&lt;T&gt;</code> and <code>Reply&lt;T&gt;</code>:</p>
<p><div><script src='https://gist.github.com/1355343.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>A <code>Lexer</code> (aka tokenizer) inspects the input plain text and converts it to a series of tokens. If we&#8217;re parsing JSON, tokens would be things like a constant, a keyword, or a puctuation symbol like [ or {. A <code>Parser</code> is any object which can consume some tokens and produce a <code>Reply</code>. A <code>Reply</code> contains the parsed object (if the input was valid), the remaining unconsumed tokens, and possibly some error messages.</p>
<p>Parsley lets you take <em>small</em> parsers that do part of the effort, and glue them together into larger parsers that do the full parsing effort. Like regexes, the glue involves repetition (&#8220;zero or more of <em>that</em> pattern&#8221;), alternation (&#8220;any one of these possible patterns&#8221;), and sequencing (&#8221;<em>this</em> pattern, followed by <em>that</em> pattern&#8221;).</p>
<h2>Repetition</h2>
<p>For repetition, we have helper functions that take in a <code>Parser&lt;T&gt;</code> and output a new <code>Parser&lt;IEnumerable&lt;T&gt;&gt;</code>. The new parser will repeatedly recognize whether the pattern appears again, consuming it until the pattern is no longer recognized. The overall <code>Reply</code> will contain an object for every occurrence of the pattern:</p>
<p><div><script src='https://gist.github.com/1355353.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<h2>Alternation</h2>
<p>For alternation, the <code>Choice</code> helper function takes in several <code>Parser&lt;T&gt;</code> and returns a new <code>Parser&lt;T&gt;</code> which recognizes when <em>any one</em> of those patterns appears next in the input text:</p>
<p><div><script src='https://gist.github.com/1355357.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<h2>Sequencing</h2>
<p>For sequencing, I <a href="http://www.headspring.com/2011/09/the-compilers-treatment-of-linq-syntax">redefined the <code>from</code> and <code>select</code> LINQ keywords</a> to provide the <em>sequencing</em> operation, gluing together small <code>Parser</code>s into a larger <code>Parser</code>.</p>
<p>In part of the JSON parser, we need to recognize the pattern of a single key/value pair for a dictionary. Such a pair is a quoted string, followed by a &#8216;:&#8217;, followed by some other JSON value. The result of the Pair rule is an object containing the relevant parts of that sequence:</p>
<p><div><script src='https://gist.github.com/1355360.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>The result of a query like this is <em>yet another</em> <code>Parser</code>. Each <code>from</code> clause consumes a little more input, and the <code>select</code> clause describes the combined result of those intermediate steps.</p>
<h2>The Problem</h2>
<p>At one point, before the <code>Parser</code> and <code>Reply</code> types used the <code>out</code> keyword, I ran into some surprising compiler errors. I <em>wanted</em> to write the following:</p>
<p><div><script src='https://gist.github.com/1355386.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Just to satisfy the compiler, though, I had to write this instead:</p>
<p><div><script src='https://gist.github.com/1355856.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>In order to pass <code>Array</code> and <code>Dictionary</code> to the <code>Choice</code> helper method, they needed to have the same type as each other. In order to satisfy the compiler after that, I was having to also include explicit <em>upcasts</em> in the <code>select</code> clauses. <strong>That is just <em>weird</em>!</strong> Have you ever had to explicitly upcast, just to satisfy the compiler? As if an array or dictionary <em>might not</em> be an <code>object</code>!</p>
<h2>The Solution</h2>
<blockquote><p><strong>When the compiler surprises you, the most direct path to getting a successful compile isn&#8217;t necessarily the right answer. First, try to understand what the compiler is trying to tell you. Ask yourself, &#8220;What is it about my code that the compiler is getting tripped up on? Why isn&#8217;t it making the decision I expected?&#8221;</strong></p></blockquote>
<p>Taking a closer look, these queries result in values of type <code>Parser&lt;object[]&gt;</code> and <code>Parser&lt;Dictionary&lt;string, object&gt;&gt;</code>, respectively, and we&#8217;re trying to assign them each to a <code>.Rule</code> property of type <code>Parser&lt;object&gt;</code>.</p>
<p>We <em>want</em> to treat any <code>Parser&lt;Child&gt;</code> as a subtype of any <code>Parser&lt;Parent&gt;</code>, whenever <code>Child</code> is a subtype of <code>Parent</code>. When we look at the <code>Parser&lt;T&gt;</code> and <code>Reply&lt;T&gt;</code> definitions, we see that the Ts always appear in the return types, never in the input types. The <code>out</code> keyword is therefore applicable here, with the desired results:</p>
<ol>
<li>Using <code>Choice</code> no longer has the suspicious side effect of requiring less-descriptive types for each rule we happen to pass to it.</li>
<li>The compiler no longer needs us to include suspicious explicit upcasts in our select clauses.</li>
</ol>
<p>&nbsp;</p>
<p><a href="http://www.headspring.com/feed" target="_blank">Subscribe to our blog feed</a> for the freshest content.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-11-11T00:00:00-06:00" pubdate data-updated="true">Nov 11<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/improve-corporate-culture-through-the-disc-test/">
		
			Improve Corporate Culture Through the DiSC Test</a>
	</h2>
	<div class="entry-content">
		<div>
<p>A variety of personalities exist in the workplace and being able to collaborate with teammates efficiently is important for a company’s success. While routines and personalities become clearer the longer employees work together, it’s also helpful to know and understand the behavioral styles of other employees and learn how to adapt to them. The DiSC Assessment is a personality test that focuses on behavioral and personality situations and is an effective tool and guideline for the workplace to use. </p>
<p>The results are productive for yourself to assess where you are, where you want to be and how you can better communicate with others, especially your teammates and customers. The assessment is also productive for your teammates because they learn your how to best work and communicate with you.</p>
<p>At Headspring, we have employees take the DiSC test when they first join the team and we use the results in our day-to-day interactions. It not only improves our team dynamic, but it helps us understand each other and our thought processes.</p>
<p>After a short questionnaire, the assessment groups you into one of four groups:</p>
<p><strong>Dominance</strong> (D) – Individuals in this group focus on control and like getting immediate results. These individuals are also direct, fast-paced, driven and strong-willed.</p>
<p><strong>Influence</strong> (I) – Individuals in this group focus on social situations. They are motivated by social recognition and being influential to others. These individuals are enthusiastic, optimistic, convincing and trusting.</p>
<p><strong>Steadiness</strong> (S) – Individuals in this group focus on structure. They are motivated by opportunities to help and stability. These individuals are patient, calm, stable and consistent.</p>
<p><strong>Compliance</strong> (C) – Individuals in this group focus on accuracy. They are driven by quality work and knowledge. These individuals are careful, tactful, systematic, and cautious.</p>
<p>Although we all have each of the four groups in us, there is usually one dominate group in each person that has a bigger presence in the way we act. While the DiSC assessment is not the end all of having the most efficient office, it’s a good reference and starting point in improving the work relationships and team building. Curious about your results and want to learn how this assessment can improve your corporate culture? Read more on <a href="http://www.discprofile.com/">DiSC</a> and consider taking the assessment for yourself.</p>
</div>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-11-10T00:00:00-06:00" pubdate data-updated="true">Nov 10<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/bonus/'>Bonus!</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/tips-on-managing-organizational-change/">
		
			Tips on Managing Organizational Change</a>
	</h2>
	<div class="entry-content">
		<p>Growing and evolving companies encounter many changes over time. Shifts in leadership, policies, new structures, targets, acquisitions, disposals, re-locations, etc., all create new systems and environments and are just a few of the organizational changes a business can go through. Although these changes might be implemented for continued growth and success, change is typically hard to deal with - especially if your team is already incredibly busy.  Resistance will probably occur – it might even occur from the person or management team who initiated the organizational changes in the first place. Remember, change of any kind is typically met with resistance. However, for a company to reach the next level or continue on the road to success, change is usually inevitable. How does a company endure and manage organizational change to keep the company from falling apart? In order to minimize difficulties, we think the key is communication. Communicate. Communicate. And then communicate some more. This will help ensure your team will not only understand, but also want to be part of the <a title="Reasons Why People Break Up…With Their Company" href="http://www.headspring.com/2011/10/reasons-why-people-break-upwith-their-company" target="_blank">big painted picture</a>.</p>
<p>Any type of organizational change needs to be explained to your entire team as clearly as possible. This might also take some follow up communication for weeks or even months after the new changes are proposed and implemented – think meetings, memos, one-on-one meetings, etc. to ensure everyone is grasping the big picture. This will also ensure your teams involvement in validating and/or refining the changes. Part of open communication means being open to listening to your team’s input. When explaining or presenting new organizational changes, avoid expressions like <em>mindset change, changing people&#8217;s mindsets </em>or<em> changing attitudes</em>. This language often indicates an imposed or enforced change, and it strongly suggests the company believes its team currently has the <em>wrong </em>mindset, which is never want you want to portray and it’s never the case. If people are not approaching their tasks or the organization effectively, then the organization has the wrong mindset, not the people.</p>
<p>How your managers communicate and participate is crucial to the change process. I repeat. How your managers communicate and participates is crucial to the change process. Your management team should enable and facilitate through communication and leadership, not just convey and implement policy from above, which does not work. You cannot impose change. Your teams need to be empowered to find their own solutions and responses, with facilitation and support from the managers. Open and frequent communication is the best way to make sure this happens. There also needs to be tolerance and compassion from the leaders and executives. This will help your team trust the organization and employees need to be able to trust the organization.</p>
<p>Following these tips will ensure any company going through organizational change can do it with success. Although there will be some challenges, open, frequent and effective communication can make this transition a lot smoother.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-11-09T00:00:00-06:00" pubdate data-updated="true">Nov 9<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/bonus/'>Bonus!</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/seamless-delegate-type-casting/">
		
			Seamless Delegate Type Casting</a>
	</h2>
	<div class="entry-content">
		<p>In <a href="http://www.headspring.com/2011/10/seamless-generic-type-casting">Seamless Generic Type Casting</a>, we saw how the <code>in</code> and <code>out</code> keywords can make our generic interfaces polite with respect to casting. A <code>List&lt;string&gt;</code> can be treated as an <code>IEnumerable&lt;object&gt;</code> because a) all strings are objects and b) <code>IEnumerable</code> is declared with the <code>out</code> keyword. Now, we&#8217;ll see how these keywords can be applied to delegate types in addition to interface types.</p>
<p>Suppose we have a a basic hierarchy of entity classes:</p>
<p><div><script src='https://gist.github.com/1339376.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Also, suppose we find ourselves creating/persisting many instances of these in our integration tests, and we create a delegate type with some helper methods for doing so:</p>
<p><div><script src='https://gist.github.com/1339379.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>In our integration tests, we may use this to quickly get some sample employees into our database:</p>
<p><div><script src='https://gist.github.com/1339417.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>As we write some tests, we realize that we need some of our sample employees to be populated differently:</p>
<p><div><script src='https://gist.github.com/1339420.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Surprise! This won&#8217;t even compile. The compiler can&#8217;t assign our <code>EntityCreator&lt;SalesPerson&gt;</code> to the expected type <code>EntityCreator&lt;Employee&gt;</code>. That&#8217;s strange, since we know that any <code>SalesPerson</code> it ever makes will <strong>obviously</strong> be an Employee. As we saw with similar situations around interfaces, we need to use the <code>out</code> keyword when we define the delegate type, promising to the compiler that the <code>T</code> will only appear in the return value. Armed with this additional promise, the compiler can safely treat all <code>EntityCreator&lt;FieldTechnician&gt;</code> as <code>EntityCreator&lt;Employee&gt;</code>. With the following change, the example compiles as expected:</p>
<p><div><script src='https://gist.github.com/1339421.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p><a href="http://www.headspring.com/feed" target="_blank">Subscribe to our blog feed</a> for the freshest content.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-11-04T00:00:00-05:00" pubdate data-updated="true">Nov 4<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/how-transparency-builds-trust/">
		
			How Transparency Builds Trust</a>
	</h2>
	<div class="entry-content">
		<p><strong>Do you really want to know how the sausage is made?</strong></p>
<p>It’s all a matter of perspective. We allow our customers to peek behind the curtain as much as they like, but not all of them want to be involved in the minutae. Want to have a daily check-in call with your team lead? Sure thing. Want to find know what tools we use to automate our regression testing? Maybe, maybe not.</p>
<p>If I’m in the market for 100 lbs of Boudin, the merchant should probably find out why I’m buying it in order to help uncover which parts of the process I would care about. They’d probably ask a lot of questions.  Are you reselling it? Do you have any allergies? How drunk are your guests going to be? Do you want to see the slaughter-room? Why not? Where are you going?</p>
<p>We’re as transparent as our customers need, it’s not a one-size fits all. That being said, there is a minimum. We don’t want a check from you only to have you disappear until the final product is done. With our iterative development process, we need feedback from our customers as we introduce our solution gradually. We don’t want to cook up a couple of hundred pots of jambalaya only for you to tell us that you don’t like okra. Iterative releases are like the sample cups.</p>
<p><strong>Tour the facility, put on a hairnet, grab that cleaver.</strong></p>
<p>We’ve all heard of a vendor that has prestigious mailing addresses on Madison Avenue, K Street, or Rodeo Drive. Meanwhile the work is being done out of a Starbucks. Not necessarily the type of people to bet the ranch on. However, if they’re upfront with how their business is done, talent can overcome infrastructure.</p>
<p>What people are really concerned about is knowing that your company uses ethical business practices and isn’t tricking them into false beliefs. We provide this transparency to our customers by having weekly face to face meetings to review hours spent on their projects and what value they will see from those hours spent.</p>
<p>Business transparency is a strong business practice that helps strengthen a company, strengthen the relationships between the company and its clients. How can your company be more transparent?</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-11-03T00:00:00-05:00" pubdate data-updated="true">Nov 3<span>rd</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/bonus/'>Bonus!</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/reasons-why-people-break-upwith-their-company/">
		
			Reasons Why People Break Up…With Their Company</a>
	</h2>
	<div class="entry-content">
		<p>The latest YouTube sensation got us thinking about why people quit their jobs. Joey DeFrancesco got help from his marching band to quit his job at a hotel, after 3.5 years of working there, because he said he was treated poorly by management. Joey surprised his manager by announcing his resignation followed by an instrumental celebration, which was filmed and posted on YouTube. His video has received almost 3 million views in 2 weeks. <a href="http://www.youtube.com/watch?v=9A4UGtM4hDQ&amp;feature=player_embedded&amp;noredirec">View Joey’s instrumental resignation</a>.</p>
<p>Similar to relationships, people and their jobs don’t always work out. In fact, the Bureau of Labor Statistics reported more employees left their jobs voluntarily than were laid off in 2010. Here are some reasons reported why people quit their jobs or are seriously considering resigning.</p>
<ul>
<li><strong>They couldn’t stand their boss</strong></li>
<li><strong>Job Stress</strong></li>
<li><strong>The company was struggling</strong></li>
<li><strong>Better opportunities</strong></li>
<li><strong>Being stretched to the limit</strong></li>
<li><strong>Boredom</strong></li>
</ul>
<p>Below are a few tips that we follow that have led to a positive impact for our employee retention efforts:</p>
<p>Studies have shown people thrive in positions where they feel they are contributing and making a difference. Employees like to be part of the big picture plan to help the company succeed, so let them know what the big picture plan is and how their role will directly impact the company getting there.</p>
<p>Employees also like to know they have a career path laid out for them at your company. Make it clear about what it takes to progress in your company. Career progression also includes salary and benefits, which will help keep employees engaged and happy.</p>
<p>Get regular feedback from your employees. Ask how you’re performing or, if appropriate, send an anonymous survey to understand what your employees think about their jobs, the company, your performance, etc. Often people don’t leave the companies, they leave poor managers. Have regular formal or informal catch-ups with your employees to gauge where they are.</p>
<p>Are there things or tips you’ve seen or are doing in your company to help employee retention?</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-10-31T00:00:00-05:00" pubdate data-updated="true">Oct 31<span>st</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/bonus/'>Bonus!</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/seamless-generic-type-casting/">
		
			Seamless Generic Type Casting</a>
	</h2>
	<div class="entry-content">
		<p>In <a href="http://www.headspring.com/2011/10/array-covariance-in-c">Array Covariance in C#</a>, we saw that a <code>List&lt;Apple&gt;</code> cannot be assigned to a variable declared as <code>List&lt;Object&gt;</code>, even though all <code>Apple</code>s are <code>Object</code>s. If we were allowed to do that, we could get runtime type exceptions as we work with the list contents.</p>
<p>The compiler has to prevent us from these assignments because <code>List&lt;T&gt;</code>&#8217;s public interface includes some subtle constraints: <code>List&lt;Apple&gt;</code> is actually a <em>more constrained</em> type than <code>List&lt;Object&gt;</code>. You can put anything into a <code>List&lt;Object&gt;</code> and get it back out again. You can&#8217;t put just anything into a <code>List&lt;Apple&gt;</code>; what would you expect to happen when you tried to read it back out? Therefore, <code>List&lt;Apple&gt;</code> is more constrained than <code>List&lt;Object&gt;</code> and we can&#8217;t treat <code>List&lt;Apple&gt;</code> as a subtype of <code>List&lt;Object&gt;</code>.</p>
<p>Still, it&#8217;s tempting to ask, is there some other generic type <code>Foo&lt;T&gt;</code> where <code>Foo&lt;Apple&gt;</code> <em>can</em> be treated as a <code>Foo&lt;Object&gt;</code>? <strong>It turns out the answer is yes!</strong></p>
<p>Let&#8217;s say your application is sending messages to another process over a message bus, and that you&#8217;ve implemented a helper method that sends a whole collection of messages instead of just one:</p>
<p><div><script src='https://gist.github.com/1321180.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Unfortunately, this won&#8217;t even compile. We&#8217;re trying to send a list of <code>RemoveOrderLineItem</code> messages, but the <code>SendAll</code> method accepts a <code>List&lt;IMessage&gt;</code>. Fortunately, this starts to compile if we change the definition of <code>SendAll</code> to receive an <code>IEnumerable&lt;IMessage&gt;</code> instead of a <code>List&lt;T&gt;</code>:</p>
<p><div><script src='https://gist.github.com/1321168.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>What&#8217;s so <em>special</em> about <code>IEnumerable&lt;IMessage&gt;</code> that lets us seamlessly cast from a <code>List&lt;RemoveOrderLineItem&gt;</code>? Remember, the reason that the compile originally failed had to do with the fact that the object we were passing to <code>SendAll</code> had more constraints than the type declared on the receiving end. With <code>IEnumerable&lt;IMessage&gt;</code>, it&#8217;s a different story. Now, the only thing that <code>SendAll</code> can do with our collection is get values out of it, and we know all such values will be individually compatable with <code>IMessage</code>.</p>
<p>We&#8217;re able to do this because, as of .NET 4, <code>IEnumerable&lt;T&gt;</code> has an updated definition:</p>
<p><div><script src='https://gist.github.com/1321170.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>The <code>out</code> keyword was added to the generic type parameter <code>T</code>. Using this keyword is a promise. <strong>&#8220;I promise that for all the members in this interface, <code>T</code> will only appear in the return types, never appearing in any inputs.&#8221;</strong> When we use the <code>out</code> keyword, we&#8217;re saying that T is &#8220;covariant&#8221;.</p>
<p>The <code>in</code> keyword makes a similar promise: the type parameter <code>T</code> could appear in the types of input arguments, but never in the return types. When we use the <code>in</code> keyword, we&#8217;re saying that <code>T</code> is &#8220;contravariant&#8221;.</p>
<p>In addition to sanity checking your promise, the compiler is now free to treat any <code>IEnumerable&lt;RemoveOrderLineItem&gt;</code> as a <code>IEnumerable&lt;IMessage&gt;</code>, without having to cast each individual item first. <code>IEnumerable&lt;RemoveOrderLineItem&gt;</code> is truly a subtype of <code>IEnumerable&lt;IMessage&gt;</code>.</p>
<p>Introducing these two keywords to the language was a nonbreaking change, with the main effect being that people encountered fewer compiler errors, usually without knowing it. When you design your own libraries, consider whether your interfaces deserve to take part in this style of casting. Beware, though, that <em>removing</em> the keywords later on can be a breaking change from the point of view of your library&#8217;s consumer!</p>
<p>In my next post, we&#8217;ll see how these keywords can be used to glue together delegates.</p>
<p><a href="http://www.headspring.com/feed" target="_blank">Subscribe to our blog feed</a> for the freshest content.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-10-28T00:00:00-05:00" pubdate data-updated="true">Oct 28<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/unit-testing-best-practices-know-your-tests-lifecycle-part-3/">
		
			Unit Testing Best Practices: Know Your Test’s Lifecycle, Part 3</a>
	</h2>
	<div class="entry-content">
		<p>This will be my last post on unit test lifecycle management. In previous posts, we <a title="Unit Testing Best Practices: Know your test’s lifecycle, Part 1" href="http://www.headspring.com/2011/08/unit-testing-best-practices-know-your-tests-lifecycle-part-1">learned how individual unit tests and test fixtures are run</a>, and <a title="Unit Testing Best Practices: Know Your Test’s Lifecycle, Part 2" href="http://www.headspring.com/2011/09/unit-testing-best-practices-know-your-tests-lifecycle-part-2">how test invocation is affected when test fixtures are derived from an abstract base fixture class</a>. In this installation, we&#8217;re going to learn how to manage code that runs before and after groups of test fixtures.</p>
<p>Sometimes, you need some code to run before or after a set of test fixtures. I tend to encounter this scenario frequently with integration and system tests. For example, if you&#8217;re using <a href="http://seleniumhq.org/">Selenium</a> to run your full system tests through the <a href="http://seleniumhq.org/projects/webdriver/">Selenium Web Driver</a>, you need to make sure that the Selenium server is running before you run any of your tests. You could do this on the build server by extending your build script with a &#8220;StartSelenium&#8221; task, and then remind all your developers to start the server themselves before they run the tests directly. But wouldn&#8217;t it be better to guarantee directly that, every time those ui tests get run, that the selenium server was active? AND, as a bonus, wouldn&#8217;t it be great if the selenium server was shut down when the tests finished?</p>
<p>Another case where this need shows up is in database-coupled integration tests. These kinds of tests often suffer from unintended order dependencies - one set of tests end up assuming that some data introduced by an earlier set of tests will be present in the database, and then those tests fail if you run them in isolation.</p>
<p>Another approach I often see people take is to have a &#8220;special&#8221; test fixture  that performs all their database initialization and initial data loading. That test fixture might look like this:</p>
<p>[gist id=1313334 file=SampleDataLoader.cs]</p>
<p>The Explicit attribute means that the test fixture is not run if you execute all the tests in the assembly by default. Typically a test like this would be run by invoking the nunit console runner from an automated build to run only tests in the &#8220;DataLoader&#8221; category.</p>
<p>That&#8217;s not bad, but again - what happens on developer system when you forget to run the dataloader tests first? Or, what do you do when you&#8217;ve got different sets of tests that need different default data? You definitely don&#8217;t want each individual test or fixture going through an entire, scorched-earth style recreation of the entire database just to get to a clean state, do you?</p>
<p>Fortunately, NUnit provides a not-well-known, but powerful, soltuion for executing code before and after <em>any</em> tests run - the SetUpFixture. It doesn&#8217;t have the greatest name in the world, as it&#8217;s easily confused with TestFixtureSetup. The difference is that SetUpFixture runs around <em>all</em> the fixtures within the same namespace. SetUpFixture classes defined outside of a namespace will run before any tests in the entire assembly. Here&#8217;s a sample:</p>
<p>[gist id=1313334 file=SetUpFixtureSample.cs]</p>
<p>Which produces this output:</p>
<p>[gist id=1313334 file=SetUpFixtureSampleOutput.txt]</p>
<p>As you can see, the SetUpFixture classes exhibit the same nesting that we&#8217;ve come to expect from constructors, Dispose methods, SetUp, and TearDown atributes. As with basic test fixtures, I recommend that you use the construct/dispose pattern for SetUpFixture classes, and avoid the SetUp and TearDown-attributed methods. There&#8217;s no need for the extra layer of initialization.</p>
<p>Also note that SetUpFixture class construction and disposal is nested by namespace. If you have two of them in the same namespace though, order of execution between the two could be non-deterministic.</p>
<p>One of the great things about these SetUp fixture classes is that they run whenever tests in the same namespace are executed, regardless of how many tests within that namespace you happen to be running. The important thing is that your context of execution is always going to be firmly established, even if you&#8217;re only running one test. Andy, by establishing the right part of your entire testing context at the right leve, you can dramatically decrease the test time for expensive tests. For example, you could rebuild the whole test database in a SetUpFixture defined at the assembly level, and then establish and remove different sets of test data for related tests, organized by namespaces. This might look like this:</p>
<p>[gist id=1313334 file=SetUpFixtureDatabaseExample.cs]</p>
<p>Which of course produces the following output:</p>
<p>[gist id=1313334 file=SetUpFixtureDatabaseExampleOutput.txt]</p>
<p>The outermost SetUpFixture ensures that you always start from a known state, by dropping and rebuilding the test database. We open up a transaction within the namespace SetUpFixture&#8217;s constructor, and roll it back in the corresponding Dispose method. This technique can help ensure that your integration tests don&#8217;t develop unintended order dependencies by relying on data injected by other, previously run tests. Once all the tests in that namespace have run, all the database changes get rolled back. Now the next set of tests can start from a known data state again.</p>
<p>SetUpFixtures, by virtue of being run outside of, and around, all of your unit test fixtures, give you a lot of options in structuring the runtime context in which your unit tests execute. They can be a very powerful tool in your testing toolbelt. Hopefully this introduction to NUnit SetUpFixtures gives you some ideas on how you can re-structure and streamline your own test management - especially for those more challenging scenarios, like UI and integration tests.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-10-25T00:00:00-05:00" pubdate data-updated="true">Oct 25<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/4-growth-strategies-for-your-evolving-business/">
		
			4 Growth Strategies for Your Evolving Business</a>
	</h2>
	<div class="entry-content">
		<p>Entrepreneurs are constantly looking for business growth strategies, especially when the business is evolving and improving. Here are four things to help lead entrepreneurs on the best path to growth and success and examples of how we implement these strategies at Headspring.</p>
<p><strong>1. Improve your leadership</strong></p>
<p>Review how you lead your team and find opportunities to improve it. The solution could be classes or getting involved in professional organizations to help you learn new best practices. Do you meet with each employee on a regular basis? You could also change your review process with your employees and find new ways to support them.</p>
<p>At Headspring, employees meet with their supervisor for a one-on-one once a month. This is a chance to discuss anything the employee or supervisor wants to. This is also a great way to encourage a collaborative and team environment.</p>
<p><strong>2. Review your business goals</strong></p>
<p>As your business evolves, your end goal may evolve also. It’s important to periodically review your business goals to keep your focus and actions aligned. Is your company still on the right track to success or do you need to shift the goals? Take in consideration your progress so far and where you want to be in the future.</p>
<p>Every quarter, our entire company meets to discuss the company’s goals, evaluate where we are, and discuss where we are headed. Then, we go spend time outside of the office doing something fun – i.e. rock climbing, laser tag, Segway tours, etc.</p>
<p><strong>3. Diversify your offerings</strong></p>
<p>Expand and diversify your offerings based on your clients’ needs. What other services or products can you offer? Think about how you can improve your clients’ experience or meet their needs. Complementary products, educational webinars and white papers or internal improvements of processes with clients can help improve and grow your business.</p>
<p>Our developers and team frequently develops open source projects, hosts numerous training and education seminars and focus on providing systems that will help our clients’ businesses grow.</p>
<p><strong>4. Develop the skills of your employees</strong></p>
<p>Are your employees improving their skills and continuing their education? When your employees improve and expand their skills, it allows them to improve their quality of work at your company, which will make your company more successful. Your company can offer company educational or seminar days for your employees or you can provide your employees with a list of options, such as classes offered in your city or educational events employees can attend.</p>
<p>We continuously encourage and support mastering a skill. We’ve built in CI time daily for employees and host peer learning lunches, which allow them to focus on anything they choose that they want to master and share what they’ve learned with the entire office.</p>
<p>What business growth strategies do you use?</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-10-24T00:00:00-05:00" pubdate data-updated="true">Oct 24<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/bonus/'>Bonus!</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/array-covariance-in-c/">
		
			Array Covariance in C#</a>
	</h2>
	<div class="entry-content">
		<p>When we first learn about inheritance, we&#8217;re given some plain-English examples with an emphasis on the phrase &#8220;is-a&#8221;. A car <em>is-a</em> vehicle, so a <code>Car</code> class would inherit from a <code>Vehicle</code> class. The idea that class inheritance can so directly map to English is <strong>seriously misleading</strong> and can get you into trouble.</p>
<p>In English, it&#8217;s fair to say that a bag of apples <em>is-a</em> bag of objects. It may have an odd sound to it, but it&#8217;s true. This makes it very tempting to say that in C#, a <code>List&lt;Apple&gt;</code> should be assignable to a <code>List&lt;Object&gt;</code>, since all <code>Apple</code> instances are also <code>Object</code> instances:</p>
<p><div><script src='https://gist.github.com/1302300.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>The sample above won&#8217;t compile. The compiler is protecting us from potential runtime type exceptions. If this compiled, we could get into trouble like so:</p>
<p><div><script src='https://gist.github.com/1302301.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>If this compiled, we would be able to attempt to put a string into a collection that simply does not support that operation. The English metaphor for inheritence (<em>is-a</em>) just doesn&#8217;t adequately match the actual constraints of the type system. We&#8217;re trying to violate the <a href="http://en.wikipedia.org/wiki/Liskov_substitution_principle">Liskov Substitution Principle</a>. If we declared that <code>List&lt;Apple&gt;</code> is a subtype of <code>List&lt;Object&gt;</code>, we&#8217;d be saying that <em>every</em> operation that acts on a <code>List&lt;Object&gt;</code> could be given a <code>List&lt;Apple&gt;</code>, and that&#8217;s simply not true. In our example, the operations performed on the <code>List&lt;Object&gt;</code> included putting new arbitrary objects into the list, and you just can&#8217;t do that to a <code>List&lt;Apple&gt;</code>.</p>
<p><strong>Because <code>List&lt;Apple&gt;</code> has more constraints than <code>List&lt;Object&gt;</code>, <code>List&lt;Apple&gt;</code> is not assignment-compatible with <code>List&lt;Object&gt;</code>.</strong></p>
<p>Unfortunately, the previous example <strong>does</strong> compile when you replace <code>List&lt;T&gt;</code> with supposedly-strongly-typed arrays. Instead of knowing that you&#8217;ve done something wrong at compile time, you get an exception at runtime:</p>
<p><div><script src='https://gist.github.com/1302325.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Because <code>TChild[]</code> can be assigned to <code>TParent[]</code> for any <code>TChild</code> inheriting from <code>TParent</code>, we can say &#8220;arrays in C# are covariant&#8221;.</p>
<p>To sum up, <code>List&lt;Apple&gt;</code> can&#8217;t be treated as <code>List&lt;Object&gt;</code> <em>because of the operations that <code>List&lt;T&gt;</code> provides</em>. The question, then, is could we ever safely take advantage of this convenient funky-casting for <em>other</em> generic types? The answer to this question falls under the category of &#8220;Covariance and Contravariance&#8221; and is provided by the C# 4 keywords <code>in</code> and <code>out</code>. In my next post, we&#8217;ll cover an example where this funky-casting is both convenient and safe.</p>
<p><a href="http://www.headspring.com/feed" target="_blank">Subscribe to our blog feed</a> for the freshest content.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-10-21T00:00:00-05:00" pubdate data-updated="true">Oct 21<span>st</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>


</div>
	
</div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/24/" class="prev">Prev</a>
    
    
        <a href="/blog/page/26/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Headspring Labs

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>

<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>When to Use a Rhino Mock, and When Not To - Headspring Labs</title>
	<meta name="author" content="Headspring Labs">

	
	<meta name="description" content="When I sit down to write a unit test, my first step is to describe for myself, in English instead of code, what I intend to test. The words I choose &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Headspring Labs" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.1.6/d3.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><a href="/"><h1>Headspring Labs</h1></a>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/HeadspringLabs" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/HeadspringLabs" title="GitHub">GitHub</a>
		
	    
		
		<a class="coderwall" href="https://coderwall.com/team/headspring" title="Coderwall">Coderwall</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	    
	</div>
</nav>
<nav id="main-nav"><ul class="main">
	<li><a href="/team">The Team</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/open-source">Open Source</a></li>
	<li><a href="/about-us">About Us</a></li>
</ul>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">When to Use a Rhino Mock, and When Not To</h2>
	<div class="entry-content"><p>When I sit down to write a unit test, my first step is to describe for myself, in English instead of code, what I intend to test. The words I choose give clues as to the structure of the test and the style: interaction-based versus state-based. I&#8217;ll describe an example below.</p>
<p>RhinoMocks, and other mocking frameworks like Moq and TypeMock, are a support structure that let you write briefer, more expressive unit tests. RhinoMocks simplifies the quick creation of fake classes that your class under test relies on and interacts with. You can use those fakes for both styles of tests; RhinoMocks can make assertions about interactions in interaction-based tests, and it can provide non-exception-throwing behavior when you just need a stand-in for your state-based tests. I listen to the language of my description to know how I want to use that Rhino Mock.</p>
<p>For example, your application might have an EmailDispatcher that decides which emails to send, then calls an EmailService to send the emails. You&#8217;d like to unit test the logic in the EmailDispatcher without sending thousands of real emails. This is a perfect scenario for RhinoMocks. RhinoMocks can build you a fake EmailService when your tests are running, and let you make assertions about when the EmailDispatcher calls that EmailService. RhinoMocks allows you to assert &#8220;When the EmailDispatcher is given input like <em>this</em>, it should call the EmailService with <em>that</em> info.&#8221;</p>
<p>Another great use for RhinoMocks is to support a class that has dependencies that aren&#8217;t interesting to the test you are writing—the class under test calls some other classes, but they aren&#8217;t relevant to the scenario you are testing. You merely need them to not be null and not throw Null Reference Exceptions when your test is running. Continuing with the above example, the EmailDispatcher could rely on a TemplateFormatter class to prepare the text of the email, but because you are writing a test fixture focusing on when emails get sent, and you are not testing how those emails are formatted, the TemplateFormatter should be as low profile in your test as possible. If TemplateFormatter is a simple class, you could just instantiate one and pass it to your EmailDispatcher under test. On the other hand, if TemplateFormatter requires its own swarm of dependencies, or if some of its operations rely on time-consuming, out-of-process dependencies like a database, replacing it with a fake class generated by RhinoMocks will keep your unit test quick and brief.</p>
<p>What is an example of misusing a Rhino Mock? Where RhinoMocks becomes a burden is when it over-specifies the interactions between classes. RhinoMocks can make assertions about how one class calls another, which is its power and its danger. This excessive over-specification inhibits refactoring because it entrenches the coupling between those classes—you&#8217;d want to change the internals of one class, but that would break so many tests and require tedious fixing of those tests, dissuading you from making the refactoring. Anything that makes you queasy about doing the right thing is a bad deal. From the EmailDispatcher example, I do want to test that emails are well formatted, but I don&#8217;t really care whether this is done by a TemplateFormatter, or some other class, or an EmailDispatcher method, or a private class within the EmailDispatcher, or&#8230; whatever. I don&#8217;t need to enforce the method by which the EmailDispatcher accomplishes its work, therefore I don&#8217;t want to write tests that enforce the way emails get formatted.</p>
<p>My rule of thumb is to tell myself, in English, what I want to verify and listen to the words I choose. Here are two examples.</p>
<p>&#8220;I want to test <em>when</em> the EmailDispatcher <em>tells</em> the EmailSender to send mail.&#8221; I used words that refer to testing the conditions under which one class calls another. Therefore, I&#8217;ll write an interaction-based test, using RhinoMocks&#8217; AssertWasCalled and AssertWasNotCalled methods.</p>
<p>&#8220;I want to test that the <em>result</em> from the EmailDispatcher&#8217;s work is an email in a <em>certain format</em>.&#8221; Looking at the properties on the result of an operation is a good fit for state-based tests. I&#8217;ll probably still use RhinoMocks to create a fake EmailSender, since I know the EmailDispatcher is going to call the EmailSender at the end, but I am not going to make any assertions about the methods called by the EmailDispatcher.</p>
<p>There&#8217;s lots of great power in RhinoMocks, where it can give you just the right tool&#8230; or enough rope to hang yourself. We talk about responsible Rhino Mocking in our <a href="http://www.headspring.com/services/developer-training/agile-bootcamp">Agile Bootcamp</a>, and I&#8217;ll be presenting some of the <a href="http://www.ctxdnug.net/Meetings/October-2011-Meeting.aspx">finer points of RhinoMocks at the Central Texas .NET User Group on October 13</a>.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-08-22T00:00:00-05:00" pubdate data-updated="true">Aug 22<span>nd</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>, <a class='category' href='/blog/categories/rhino-mocks/'>rhino mocks</a>, <a class='category' href='/blog/categories/tdd/'>tdd</a>, <a class='category' href='/blog/categories/unit-testing/'>unit testing</a>


</div>
	
</div>


</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
		
		
		<a class="addthis_button_tweet"></a>
		
		
		
	</div>
	
</div>


</div>
	<footer id="footer" class="inner"><div class="related-links">
	<h3>Other Headspring Sites</h3>
	<ul>
		
		
			<li><a href="http://www.headspring.com">Headspring</a></li>
		
		
			<li><a href="http://www.headspringmobile.com">Headspring Mobile</a></li>
		
	</ul>
</div>

<div class="related-links">
	<h3>Communities/Groups</h3>
	<ul>
		
		
			<li><a href="http://www.adnug.org">ADNUG</a></li>
		
		
			<li><a href="http://polyglotprogrammers.org/">Polyglot Programmers</a></li>
		
	</ul>
</div>

<div class="related-links">
	<h3>Open Source</h3>
	<ul>
		
		
			
				
				<li><a href="http://automapper.org">AutoMapper</a></li>
				
			
		
		
			
				
				<li><a href="https://github.com/HeadspringLabs/Enumeration">Enumeration</a></li>
				
			
		
		
			
				
				<li><a href="http://chrismissal.com/Formo">Formo</a></li>
				
			
		
		
			
				
				<li><a href="http://plioi.github.io/fixie">Fixie</a></li>
				
			
		
		
			
		
		
			
		
		
			
		
	</ul>
</div>

<div class="related-links">
	<h3>Events</h3>
	<ul>
		
		
			<li><a href="http://ctxgivecamp.org/">Central Texas GiveCamp</a></li>
		
		
			<li><a href="http://www.houstontechfest.org/">Houston Tech Fest</a></li>
		
		
			<li><a href="http://codecamp13.adnug.org/">Austin Code Camp</a></li>
		
	</ul>
</div>

<hr />

Copyright &copy; 2013

    Headspring Labs

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-42793327-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>
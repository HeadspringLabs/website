
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Creating a Glimpse plugin to log SQL generated by NHibernate - Headspring Labs</title>
	<meta name="author" content="Headspring Labs">

	
	<meta name="description" content="Glimpse has generated a lot of buzz since it was unveiled earlier this year during the “Open Source Fest” at the Mix 2011 conference. If you’re not &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Headspring Labs" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.1.6/d3.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><a href="/"><h1>Headspring Labs</h1></a>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/team">The Team</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/open-source">Open Source</a></li>
	<li><a href="/about-us">About Us</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:headspringlabs.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/HeadspringLabs" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/HeadspringLabs" title="GitHub">GitHub</a>
		
	    
		
		<a class="coderwall" href="https://coderwall.com/team/headspring" title="Coderwall">Coderwall</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:headspringlabs.com">
	</form>
</nav>
<nav id="main-nav"><ul class="main">
	<li><a href="/team">The Team</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/open-source">Open Source</a></li>
	<li><a href="/about-us">About Us</a></li>
</ul>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Creating a Glimpse Plugin to Log SQL Generated by NHibernate</h2>
	<div class="entry-content"><p>Glimpse has generated a lot of buzz since it was <a href="http://channel9.msdn.com/Shows/HanselminutesOn9/Hanselminutes-on-9-Glimpse-at-the-Mix11-Open-Source-Fest" target="_blank">unveiled</a> earlier this year during the “Open Source Fest” at the Mix 2011 conference. If you’re not already using it to debug your ASP.NET Web Forms or MVC application, you should be. Glimpse allows you to inspect several server-side diagnostic and request related information with a UI just like Firebug. Here’s some resources to get you started if you need an intro:</p>
<ul>
<li><a href="http://getglimpse.com/" target="_blank">GetGlimpse.com</a></li>
<li><a href="http://www.hanselman.com/blog/NuGetPackageOfTheWeek5DebuggingASPNETMVCApplicationsWithGlimpse.aspx" target="_blank">NuGet Package of the Week – Glimpse</a></li>
</ul>
<p>There are several <a href="http://getglimpse.com/Help" target="_blank">built-in plugins</a> for Web Forms and MVC that will serve many needs, and you can even create your own. This tutorial will demonstrate how to create a plugin that will display the SQL generated by NHibernate.</p>
<h2>Glimpse Plugins</h2>
<p>Plugins are implemented by a simple class that implements the IGlimpsePlugin interface. There are a couple of great “hello world” example plugins on the Glimpse <a href="http://getglimpse.com/Help/CreatingPlugins" target="_blank">creating plugins page</a>. Besides setting the name and some optional start-up code, a plugin’s main job is just to return some set of data that will be rendered to the Glimpse UI. What that data is and how we get it is the real magic, so read on below.</p>
<p>The actual code for this NHibernate Glimpse plugin is fairly simple. We create a header column, add a row indicating the number of SQL statements that were executed and then add all the actual SQL to the plugin data. The SqlLogger class referenced here is just a static class that acts as a wrapper for the HttpContext.Items collection, which is where we’re logging the SQL itself. You can find a full gist including this class and all of the following code snippets, with comments, <a href="https://gist.github.com/1114503" target="_blank">here</a>.</p>
<p><div><script src='https://gist.github.com/1114428.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<h2>Logging the SQL generated by NHibernate</h2>
<p>The easiest way to log the SQL generated by NHibernate so it can be pushed up to Glimpse is to create a custom Log4Net appender and configure it in the web.config. It’s as simple as creating a class that extends the AppenderSkeleton base class and implement the Append method, like so:</p>
<p><div><script src='https://gist.github.com/1114440.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<p>Wiring up the web.config:</p>
<p><div><script src='https://gist.github.com/1114446.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
<h2>The hard part</h2>
<p>There is no hard part! We’re done! Drop this into an application that’s using NHibernate, enable Glimpse, click over to the new NHibernate tab, and wonder how you ever lived without this.</p>
<p><a href="http://www.headspring.com/wp-content/uploads/2011/07/GlimpseNhibernate.png"><img style="padding-left: 0px; padding-right: 0px; padding-top: 0px; border-width: 0px;" src="http://www.headspring.com/wp-content/uploads/2011/07/GlimpseNhibernate_thumb.png" alt="NHibernate Glimpse Plugin" width="559" height="145" border="0" /></a></p>
<p>The complete source code with comments is available <a href="https://gist.github.com/1114503" target="_blank">here</a>.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-07-29T00:00:00-05:00" pubdate data-updated="true">Jul 29<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/developer-deep-dive/'>Developer Deep Dive</a>, <a class='category' href='/blog/categories/debugging/'>debugging</a>, <a class='category' href='/blog/categories/glimpse/'>glimpse</a>, <a class='category' href='/blog/categories/nhibernate/'>nhibernate</a>, <a class='category' href='/blog/categories/sql/'>sql</a>


</div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
		
		
		<a class="addthis_button_tweet"></a>
		
		
		
	</div>
	
</div>


</div>
	<footer id="footer" class="inner"><div class="related-links">
	<h3>Other Headspring Sites</h3>
	<ul>
		
		
			<li><a href="http://www.headspring.com">Headspring</a></li>
		
		
			<li><a href="http://www.headspringmobile.com">Headspring Mobile</a></li>
		
	</ul>
</div>

<div class="related-links">
	<h3>Communities/Groups</h3>
	<ul>
		
		
			<li><a href="http://www.adnug.org">ADNUG</a></li>
		
		
			<li><a href="http://polyglotprogrammers.org/">Polyglot Programmers</a></li>
		
	</ul>
</div>

<div class="related-links">
	<h3>Open Source</h3>
	<ul>
		
		
			
				
				<li><a href="http://automapper.org">AutoMapper</a></li>
				
			
		
		
			
				
				<li><a href="https://github.com/HeadspringLabs/Enumeration">Enumeration</a></li>
				
			
		
		
			
				
				<li><a href="http://chrismissal.com/Formo">Formo</a></li>
				
			
		
		
			
				
				<li><a href="http://plioi.github.io/fixie">Fixie</a></li>
				
			
		
		
			
		
		
			
		
		
			
		
	</ul>
</div>

<div class="related-links">
	<h3>Events</h3>
	<ul>
		
		
			<li><a href="http://ctxgivecamp.org/">Central Texas GiveCamp</a></li>
		
		
			<li><a href="http://www.houstontechfest.org/">Houston Tech Fest</a></li>
		
		
			<li><a href="http://codecamp13.adnug.org/">Austin Code Camp</a></li>
		
	</ul>
</div>

<hr />

Copyright &copy; 2013

    Headspring Labs

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>